#!/usr/bin/env node




































































parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"commands-description.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommandDescription={"--message":"Simple commit message when deploying module","--out-dir":"Parcel build out dir","--file":"Pass file path after this argument","--namespace":"How this module will be named ? Later when you install it you can use it as follow import { MyModule } from '@mynamespace'","--beat":"How many seconds the application should stay after deploy recomended 20 seconds so file will be distributed accross the network","--html":"Pass your html file this will override module and will injet your html before metadata","--html-message":"Pass your html file this will override --message or 3-th argument message and you can put whole html","--webui":"Will spawn web ui with many settings, history, last deployed module etc. can be passed with --open-browser argument","--open-browser":"Will open browser for web user interface","--graphiql-playground":"Development purposes open graphiql-playground dev tools","--node-only":"Will just spawn node so you can use it for persistent data","--silent":"Will silent every program output log","--unminify":"Tell ParcelJS to not minify or uglify current deployed module","--browser":"Will tell ParcelJS to build current module for browser","--tsconfig":"Create tsconfig file if not exist","--verbose":"Better logging or you can use -v argument for simplicity","--default-ipfs-node":"Default ipfs node is GO but if you want you can use JS '--default-ipfs-node js'","--ipfs-api-gateway":"This is the address of the IPFS Gatway default: 8081","--ipfs-api-port":"This is the port of the IPFS Api default: 5002","--ipfs-swarms":"These are the swarms for the Ipfs daemon passing them with comma separated example: --ipfs-swarms /ip4/0.0.0.0/tcp/4001,/ip6/::/tcp/4001, etc...","--deployer-config-name":"This is default reactive.json filename you can change with other but in this moment is not tested very well","--graphiql":"Open GraphiQL dev screen","--open-browser-graphiql":"Open browser for development purposes with Graphiql Dev tools","--webui-server-watcher":"If this argument passed we can spawn our server watcher so we can manage syncronization with UI and passing data from the rxdi-deploy server","--webui-server-watcher-port":"Watcher port is the main status port for webui if changed webui will not work defaults: 8957","--graphiql-subscription-endpoint":"Graphiql Dev tool subscription endpoint","--graphiql-auth-token":"Authentication token for graphiql dev tools","--graphql-endpoint":"Endpoint for the Graphql webserver","--write-effects":"Development effects are for graphql webserver can be checked here for more info https://github.com/Stradivario/gapi","--graphql-server-only":"This argument will start also graphql web server so you can start making queries and interact with deployer only via API","--graphiql-endpoint":"Endpoint for Graphiql development tools","--graphql-api-port":"Development server api port is random, if not set --random-port will default to: 9300","--random-port":"This parameter will set random port to Graphql Server if for example you dont have the port avalable","--disable-package-collection":"Disable collecting dependencies from package.json","--collect-packages":"Collect dependencies from package.json and transfer it to reactive.json","--help":"This help suite :)","--server-push-interval":"Interval for server push service this is how fast the data will update by default is 7 seconds","--enable-full-folder-access":"Will give you reading and writing the whole file system so you can scan and build every folder and file (development only)","--customComponent":"Default ipfs module view component link","--interceptor":"Pass Javascript or Typescript file to customize your Request/Response logic and Authorization","--import":"Pass @rxdi module like a regular Import object","--globals":"Install npm packages inside container separated by comma `@rxdi/core, @rxdi/hapi`, etc."};
},{}],"commands.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./commands-description");function r(e){return e.reduce((e,r)=>(e[r]=r,e),Object.create(null))}exports.Commands=r(["--message","--out-dir","--file","--namespace","--beat","--html","--html-message","--webui","--open-browser","--node-only","--silent","--unminify","--browser","--v","--tsconfig","--verbose","--default-ipfs-node","--deployer-config-name","--open-browser-graphiql","--webui-server-watcher","--webui-server-watcher-port","--random-port","--graphiql","--graphiql-subscription-endpoint","--graphiql-playground","--graphiql-auth-token","--graphiql-endpoint","--graphql-endpoint","--write-effects","--graphql-api-port","--disable-package-collection","--collect-packages","--server-push-interval","--help","--ipfs-api-gateway","--ipfs-api-port","--ipfs-swarms","--graphql-server-only","--enable-full-folder-access","--customComponent","--interceptor","--import","--globals"]),exports.ExcludedFromHelpers=r(["--v"]),Object.keys(exports.Commands).map(r=>{if(Object.keys(exports.ExcludedFromHelpers).filter(e=>e===r).length)return;Object.keys(e.CommandDescription).filter(e=>e===r).length||(console.error(`\nMissing helper for command ${r} if you seen this message the developers don't do their job very well and this release is broken...\n        `),process.exit(0))});
},{"./commands-description":"commands-description.ts"}],"check-arguments.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./commands"),t=require("./commands-description"),n=(e,t,n=32)=>{const s=e.split(""),o=t.split(""),i=s.filter((e,t)=>e===o[t]).length/s.length*100;return i>n&&(console.log("Command similarity",i+"%"),e)},s=process.argv.slice(2),o=s.filter(e=>e.includes("--"));exports.checkArguments=(()=>{o.map(o=>{if(!Object.keys(t.CommandDescription).filter(e=>e===o).length&&s.length){const t=Object.keys(e.Commands).filter(e=>n(e.split("--")[1],o.split("--")[1])).toString();let s="";t.length&&(s=`maybe you mean '${t}'`),console.error(`\nUnknown option '${o}' ${s}?\nMore options you can find passing --help argument\n            `),process.exit(0)}})});
},{"./commands":"commands.ts","./commands-description":"commands-description.ts"}],"app/services/helpers/helpers.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.includes=(e=>process.argv.toString().includes(e)),exports.nextOrDefault=((e,r=!0,s=(e=>e))=>{if(process.argv.toString().includes(e)){const t=process.argv[process.argv.indexOf(e)+1];return t?t.includes("--")?r:s(t):r}return r});
},{}],"app/services/logger/logger.service.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,o){var c,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var n=e.length-1;n>=0;n--)(c=e[n])&&(s=(i<3?c(s):i>3?c(t,r,s):c(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),r=require("rxjs");let o=class{constructor(){this.stdout=new r.BehaviorSubject("")}};o=e([t.Service()],o),exports.LoggerService=o;
},{}],"app/services/arguments/arguments.service.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,c){var l,o=arguments.length,n=o<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,c);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(n=(o<3?l(n):o>3?l(t,r,n):l(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),r=require("../helpers/helpers");let c=class{nextOrDefault(e,t=null,c=(e=>e)){return r.nextOrDefault(e,t,c)}};c=e([t.Service()],c),exports.ArgumentsService=c;
},{"../helpers/helpers":"app/services/helpers/helpers.ts"}],"env.injection.tokens.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");exports.__ROOT_FOLDER=new e.InjectionToken("root_folder"),exports.__NODE_MODULES=new e.InjectionToken("local_node_modules"),exports.__DEPLOYER_ARGUMENTS=new e.InjectionToken("rxdi-deployer-command-arguments"),exports.__PARCEL_BROWSER_BUILD=new e.InjectionToken("rxdi-deployer-parcel-is-browser-build"),exports.__PARCEL_MINIFY=new e.InjectionToken("rxdi-deployer-parcel-minify"),exports.__PARCEL_BUILD_OUT_DIR=new e.InjectionToken("rxdi-deployer-parcel-build-out-dir"),exports.__PARCEL_SETTINGS=new e.InjectionToken("rxdi-deployer-parcel-settings"),exports.__GENERATE_TS_CONFIG=new e.InjectionToken("rxdi-deployer-tsconfig-generate"),exports.__FILE_PATH=new e.InjectionToken("rxdi-deployer-file-path"),exports.__FILE_NAME=new e.InjectionToken("rxdi-deployer-file-name"),exports.__NAMESPACE=new e.InjectionToken("rxdi-deployer-namespace"),exports.__FOLDER=new e.InjectionToken("rxdi-deployer-folder"),exports.__FILE_EXTENSION=new e.InjectionToken("rxdi-deployer-file-extension"),exports.__IPFS_NODE_RESOLUTION_TIME=new e.InjectionToken("rxdi-deployer-node-resolution-time"),exports.__DEPLOYER_OUTPUT_CONFIG_NAME=new e.InjectionToken("rxdi-deployer-default-migration-package-name"),exports.__PROCESSING_TIME_INIT=new e.InjectionToken("rxdi-deployer-processin-time-init"),exports.__PROCESSING_TIME_FINISH=new e.InjectionToken("rxdi-deployer-processin-time-finish"),exports.__PROCESSING_TIME_END=new e.InjectionToken("rxdi-deployer-processin-time-end"),exports.__SETTINGS_DATABASE=new e.InjectionToken("rxdi-deployer-home-settings"),exports.__BUILD_HISTORY_DATABASE=new e.InjectionToken("rxdi-deployer-build-history-database"),exports.__PREVIWS_DATABASE=new e.InjectionToken("rxdi-deployer-previews-database"),exports.__TRANSACTIONS_DATABASE=new e.InjectionToken("rxdi-deployer-transactions-database"),exports.__NAMESPACE_DB=new e.InjectionToken("rxdi-deployer-namespace-database"),exports.__HOME_DIR=new e.InjectionToken("rxdi-deployer-home-directory"),exports.__COMMIT_MESSAGE=new e.InjectionToken("rxdi-deployer-commit-message"),exports.__CREATE_HTML_PAGE=new e.InjectionToken("rxdi-deployer-commit-message"),exports.RequestHandler=new e.InjectionToken("rxdi-deployer-request-handler-external");class o{}exports.DagModel=o;class n{}exports.PreviousModel=n;
},{}],"app/services/tsconfig-generator/tsconfig-generator.service.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,n,t,r){var o,s=arguments.length,i=s<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,n,t,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(i=(s<3?o(i):s>3?o(n,t,i):o(n,t))||i);return s>3&&i&&Object.defineProperty(n,t,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core");let t=class{getTsConfig(e){return`\n{\n    "compilerOptions": {\n        "declaration": true,\n        "module": "commonjs",\n        "target": "es6",\n        "baseUrl": "src",\n        "stripInternal": true,\n        "emitDecoratorMetadata": true,\n        "experimentalDecorators": true,\n        "moduleResolution": "node",\n        "outDir": ".",\n        "lib": [\n            "es2017",\n            "es2016",\n            "es2015",\n            "es6",\n            "dom",\n            "esnext.asynciterable"\n        ],\n        "skipLibCheck": true,\n        "typeRoots": [\n            "node_modules/@types"\n        ]\n    },\n    "include": [\n        "."\n    ],\n    "files": [\n        "${e}.ts"\n    ]\n}`}getPackageJson(){return'\n{\n  "browserslist": [\n      "last 1 chrome versions"\n  ]\n}\n'}};t=e([n.Service()],t),exports.TsConfigGenratorService=t;
},{}],"app/services/file/file.service.ts":[function(require,module,exports) {
"use strict";var e,i,t=this&&this.__decorate||function(e,i,t,r){var o,n=arguments.length,c=n<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,i,t,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(c=(n<3?o(c):n>3?o(i,t,c):o(i,t))||c);return n>3&&c&&Object.defineProperty(i,t,c),c},r=this&&this.__metadata||function(e,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,i)},o=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))(function(o,n){function c(e){try{s(r.next(e))}catch(i){n(i)}}function l(e){try{s(r.throw(e))}catch(i){n(i)}}function s(e){e.done?o(e.value):new t(function(i){i(e.value)}).then(c,l)}s((r=r.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),c=require("fs");let l=class{constructor(e,i){this.fileService=e,this.logger=i}ensureDir(e){return this.fileService.mkdirp(e)}readFile(e){return o(this,void 0,void 0,function*(){return yield this.readFilePromisify(e)})}writeFile(e,i){return o(this,void 0,void 0,function*(){return yield this.writeFilePromisify(e,i)})}createFolder(e){return o(this,void 0,void 0,function*(){return yield this.fileService.mkdirp(e).toPromise()})}fileWalker(e){return this.fileService.fileWalker(e)}readFilePromisify(e){return new Promise((i,t)=>{c.readFile(e,"utf8",(e,r)=>{e&&t(e),i(r)})})}readFilePromisifyFallback(e){return new Promise((i,t)=>o(this,void 0,void 0,function*(){c.readFile(e,"utf8",(r,n)=>r?(this.logger.error("Fallback missing reactive.json file will create one!"),this.writeFile(e,JSON.stringify({name:"",typings:"",module:"",message:"",previews:[]})).then(()=>o(this,void 0,void 0,function*(){return i(yield this.readFilePromisify(e))})).catch(e=>t(e))):i(n))}))}writeFilePromisify(e,i,t="utf-8"){return new Promise((r,o)=>{c.writeFile(e,i,{encoding:t},e=>{e&&o(e),r(!0)})})}readFileRaw(e){return new Promise((i,t)=>{c.readFile(e,(e,r)=>{e&&t(e),i(r)})})}};l=t([n.Service(),r("design:paramtypes",["function"==typeof(e=void 0!==n.FileService&&n.FileService)?e:Object,"function"==typeof(i=void 0!==n.BootstrapLogger&&n.BootstrapLogger)?i:Object])],l),exports.FileService=l;
},{}],"environment-setter.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,i){var o,a=arguments.length,s=a<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,t,i);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(s=(a<3?o(s):a>3?o(r,t,s):o(r,t))||s);return a>3&&s&&Object.defineProperty(r,t,s),s},r=this&&this.__awaiter||function(e,r,t,i){return new(t||(t=Promise))(function(o,a){function s(e){try{_(i.next(e))}catch(r){a(r)}}function n(e){try{_(i.throw(e))}catch(r){a(r)}}function _(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(s,n)}_((i=i.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),i=require("./app/services/arguments/arguments.service"),o=require("./env.injection.tokens"),a=require("./app/services/tsconfig-generator/tsconfig-generator.service"),s=require("./app/services/file/file.service"),n=require("os"),_=require("nedb"),d=require("./app/services/helpers/helpers"),c=require("fs");let l=class{};l=e([t.Module({services:[{provide:"isLockExists",deps:[s.FileService],lazy:!0,useFactory:e=>r(this,void 0,void 0,function*(){const r=`${n.homedir()}/.jsipfs/repo.lock`,t=`${n.homedir()}/.jsipfs/datastore/LOCK`;try{yield e.readFile(r),c.unlinkSync(r)}catch(i){}try{yield e.readFile(t),c.unlinkSync(t)}catch(i){}return!0})},{provide:o.__DEPLOYER_ARGUMENTS,useFactory:()=>process.argv.slice(2)},{provide:o.__NODE_MODULES,useValue:__dirname.replace("dist","")+"/node_modules"},{provide:o.__ROOT_FOLDER,useValue:__dirname.replace("dist","")},{provide:o.__HOME_DIR,useValue:n.homedir()},{provide:o.__COMMIT_MESSAGE,deps:[o.__DEPLOYER_ARGUMENTS],useFactory:e=>{const r=d.nextOrDefault("--message",!1);return r||(e[2]&&e[2].includes("--")?"":e[2]||"")}},{provide:o.__PARCEL_BROWSER_BUILD,useFactory:()=>d.includes("--browser")},{provide:o.__PARCEL_MINIFY,useFactory:()=>!d.includes("--unminify")},{provide:o.__PARCEL_BUILD_OUT_DIR,useFactory:()=>d.nextOrDefault("--out-dir","build")},{provide:o.__PARCEL_SETTINGS,useFactory:()=>({watch:!1,logLevel:3,detailedReport:!0})},{provide:o.__GENERATE_TS_CONFIG,useFactory:()=>d.includes("--tsconfig")},{provide:o.__FILE_PATH,deps:[o.__DEPLOYER_ARGUMENTS],useFactory:e=>d.includes("--file")?d.nextOrDefault("--file",""):e[0]&&e[0].includes("--")&&e[0]&&!e[0].match(/[^\\]*\.(\w+)$/)?"./index.ts":e[0]||"./index.ts"},{provide:o.__FILE_NAME,deps:[o.__FILE_PATH],useFactory:e=>e.split("/").pop()},{provide:o.__NAMESPACE,deps:[o.__DEPLOYER_ARGUMENTS],useFactory:e=>d.includes("--namespace")?d.nextOrDefault("--namespace","@rxdi"):e[1]&&e[1].includes("--")?"@rxdi":e[1]||"@rxdi"},{provide:o.__FOLDER,deps:[o.__FILE_PATH],useFactory:e=>e.substring(0,e.lastIndexOf("/"))},{provide:o.__FILE_EXTENSION,deps:[o.__FILE_PATH],useFactory:e=>e.match(/\.([0-9a-z]+)(?:[\?#]|$)/i)?e.match(/\.([0-9a-z]+)(?:[\?#]|$)/i)[0]:"ts"},{provide:o.__IPFS_NODE_RESOLUTION_TIME,useFactory:()=>d.nextOrDefault("--beat",20,Number)},{provide:o.__DEPLOYER_OUTPUT_CONFIG_NAME,useValue:d.nextOrDefault("--deployer-config-name","reactive.json")},{provide:o.__PROCESSING_TIME_INIT,useFactory:()=>Date.now()},{provide:o.__PROCESSING_TIME_FINISH,useFactory:()=>d.nextOrDefault("--deployer-config-name","reactive.json")},{provide:o.__PROCESSING_TIME_END,deps:[i.ArgumentsService],useFactory:()=>d.nextOrDefault("--deployer-config-name","reactive.json")},{provide:o.__CREATE_HTML_PAGE,deps:[i.ArgumentsService],useFactory:()=>d.nextOrDefault("--html","<h1>@rxdi decentralized module</h1>")},{provide:"init-ts-config-file",deps:[o.__GENERATE_TS_CONFIG,o.__FILE_NAME,o.__FOLDER,a.TsConfigGenratorService,s.FileService],lazy:!0,useFactory:(e,t,i,o,a)=>r(this,void 0,void 0,function*(){return e&&(yield a.writeFile(i+"/tsconfig.json",o.getTsConfig(t.replace(".ts","")))),e})},{provide:o.__SETTINGS_DATABASE,deps:[o.__HOME_DIR],lazy:!0,useFactory:e=>new Promise(r=>{const t=new _({filename:`${e}/.rxdi/settings`,autoload:!0,timestampData:!0});t.loadDatabase(e=>{if(e)throw new Error("Error loading database!");r(t)})})},{provide:o.__NAMESPACE_DB,deps:[o.__HOME_DIR],lazy:!0,useFactory:e=>new Promise(r=>{const t=new _({filename:`${e}/.rxdi/namespace`,autoload:!0,timestampData:!0});t.loadDatabase(e=>{if(e)throw new Error("Error loading database!");r(t)})})},{provide:o.__BUILD_HISTORY_DATABASE,deps:[o.__HOME_DIR],lazy:!0,useFactory:e=>new Promise(r=>{const t=new _({filename:`${e}/.rxdi/history`,autoload:!0,timestampData:!0});t.loadDatabase(e=>{if(e)throw new Error("Error loading database!");r(t)})})},{provide:o.__PREVIWS_DATABASE,deps:[o.__HOME_DIR],lazy:!0,useFactory:e=>new Promise(r=>{const t=new _({filename:`${e}/.rxdi/previews`,autoload:!0});t.loadDatabase(e=>{if(e)throw new Error("Error loading database!");r(t)})})},{provide:o.__TRANSACTIONS_DATABASE,deps:[o.__HOME_DIR],lazy:!0,useFactory:e=>new Promise(r=>{const t=new _({filename:`${e}/.rxdi/transactions`,autoload:!0,timestampData:!0});t.loadDatabase(e=>{if(e)throw new Error("Error loading database!");r(t)})})}]})],l),exports.EnvironemntSetterModule=l;
},{"./app/services/arguments/arguments.service":"app/services/arguments/arguments.service.ts","./env.injection.tokens":"env.injection.tokens.ts","./app/services/tsconfig-generator/tsconfig-generator.service":"app/services/tsconfig-generator/tsconfig-generator.service.ts","./app/services/file/file.service":"app/services/file/file.service.ts","./app/services/helpers/helpers":"app/services/helpers/helpers.ts"}],"app/services/ipfs-file/ipfs-file.service.ts":[function(require,module,exports) {
"use strict";var e,t,i=this&&this.__decorate||function(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},s=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{f(n.next(e))}catch(t){s(t)}}function a(e){try{f(n.throw(e))}catch(t){s(t)}}function f(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}f((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("@rxdi/core"),a=require("stream"),f=require("@gapi/ipfs-daemon/ipfs-daemon-node-info"),p=require("@gapi/ipfs-daemon"),c=require("rxjs"),h=require("http"),u=require("https"),d=require("rxjs/operators");let l=class{constructor(e,t,i){this.ipfsDaemon=e,this.ipfsDaemonNodeInfo=t,this.logger=i,this.nodeInfo=this.ipfsDaemonNodeInfo.info,this.providers={infura:"https://ipfs.infura.io/ipfs/",cloudflare:"https://cloudflare-ipfs.com/ipfs/",ipfsOriginal:"https://ipfs.io/ipfs/",thisNode:`http://${this.ipfsDaemonNodeInfo.info.gatewayHost}:${this.ipfsDaemonNodeInfo.info.gatewayPort}/ipfs/`}}addFile(e,t){return s(this,void 0,void 0,function*(){const i=new a.Readable;i.push(e),i.push(null);const n={content:i,path:null};t&&Object.assign(n,t);const r=yield this.ipfsDaemon.api.add([n]);try{this.ping(r[0].hash).subscribe()}catch(s){}return this.logger.log(`Cloudflare: ${this.providers.cloudflare}${r[0].hash}`),r})}addFiles(e){return s(this,void 0,void 0,function*(){const t=e.map(e=>{const t=new a.Readable;return t.push(e),t.push(null),{content:t}});return yield this.ipfsDaemon.api.add(t)})}ping(e){return this.httpObservable(`${this.providers.thisNode}${e}`).pipe(d.switchMap(()=>c.combineLatest(this.httpObservable(`${this.providers.infura}${e}`),this.httpObservable(`${this.providers.cloudflare}${e}`),this.httpObservable(`${this.providers.ipfsOriginal}${e}`))))}httpObservable(e){return c.Observable.create(t=>{e.includes("https")?u.get(e,e=>t.next(e)):h.get(e,e=>t.next(e))})}wait(e){return s(this,void 0,void 0,function*(){return yield new Promise((t,i)=>this.ping(e[0].hash).subscribe(e=>t(e),e=>i(e)))})}addPackage(e){return s(this,void 0,void 0,function*(){return yield this.addFile(JSON.stringify(e,null,4))})}catIpfsFile(e){return s(this,void 0,void 0,function*(){return yield this.ipfsDaemon.api.cat(e)})}getIpfsFile(e){return s(this,void 0,void 0,function*(){return yield this.ipfsDaemon.api.get(e)})}addRawFile(e){return s(this,void 0,void 0,function*(){const t=yield this.ipfsDaemon.api.add([{content:e}]);return this.ping(t[0].hash).subscribe(),t})}};l=i([o.Service(),r(0,o.Inject(p.IPFS_DAEMON)),n("design:paramtypes",[Object,"function"==typeof(e=void 0!==f.IpfsDaemonInfoService&&f.IpfsDaemonInfoService)?e:Object,"function"==typeof(t=void 0!==o.BootstrapLogger&&o.BootstrapLogger)?t:Object])],l),exports.FileIpfsService=l;
},{}],"app/services/parcel-bundler/parcel-bundler.service.ts":[function(require,module,exports) {
"use strict";var e,t,n,i,r=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,i);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(c=(o<3?r(c):o>3?r(t,n,c):r(t,n))||c);return o>3&&c&&Object.defineProperty(t,n,c),c},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},u=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function c(e){try{s(i.next(e))}catch(t){o(t)}}function u(e){try{s(i.throw(e))}catch(t){o(t)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(c,u)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("@rxdi/core"),_=require("parcel-bundler"),l=require("../../../env.injection.tokens");let d=class{constructor(e,t,n,i){this.isBrowserBuild=e,this.isBuildMinfied=t,this.buildOutDir=n,this.settings=i}prepareBundler(e,t=null,n){return u(this,void 0,void 0,function*(){return new Promise((i,r)=>{const o=Object.assign({target:this.isBrowserBuild?"browser":"node",minify:this.isBuildMinfied,autoInstall:!0,outFile:n,outDir:t||this.buildOutDir},this.settings),c=new _(e,o);let u=null;c.on("bundled",e=>{u=e}),c.on("buildEnd",()=>{process.argv.toString().includes("--silent")?console.log=(()=>null):process.stdout.write(`Parcel Build finished! Bundle source: ${u.name}\n`),u=null,setTimeout(()=>i(),1e3)}),c.on("buildError",e=>r(e)),c.bundle()})})}};d=r([s.Service(),c(0,s.Inject(l.__PARCEL_BROWSER_BUILD)),c(1,s.Inject(l.__PARCEL_MINIFY)),c(2,s.Inject(l.__PARCEL_BUILD_OUT_DIR)),c(3,s.Inject(l.__PARCEL_SETTINGS)),o("design:paramtypes",["function"==typeof(e=void 0!==l.__PARCEL_BROWSER_BUILD&&l.__PARCEL_BROWSER_BUILD)?e:Object,"function"==typeof(t=void 0!==l.__PARCEL_BROWSER_BUILD&&l.__PARCEL_BROWSER_BUILD)?t:Object,"function"==typeof(n=void 0!==l.__PARCEL_BUILD_OUT_DIR&&l.__PARCEL_BUILD_OUT_DIR)?n:Object,"function"==typeof(i=void 0!==l.__PARCEL_SETTINGS&&l.__PARCEL_SETTINGS)?i:Object])],d),exports.ParcelBundlerService=d;
},{"../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/services/file/file-user.service.ts":[function(require,module,exports) {
"use strict";var e,t,i=this&&this.__decorate||function(e,t,i,r){var n,o=arguments.length,c=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(o<3?n(c):o>3?n(t,i,c):n(t,i))||c);return o>3&&c&&Object.defineProperty(t,i,c),c},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,o){function c(e){try{f(r.next(e))}catch(t){o(t)}}function s(e){try{f(r.throw(e))}catch(t){o(t)}}function f(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(c,s)}f((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("@rxdi/core"),c=require("./file.service"),s=require("../../../env.injection.tokens");let f=class{constructor(e){this.fileService=e}writeFile(e,t,i){return n(this,void 0,void 0,function*(){return yield new Promise((r,o)=>n(this,void 0,void 0,function*(){this.fileService.ensureDir(`${this.parcelBuildDir}/${i}`).subscribe(()=>n(this,void 0,void 0,function*(){yield this.fileService.writeFile(`${this.parcelBuildDir}/${i}/${t}`,e),r(!0)}),e=>o(e))}))})}writeDag(e,t){return n(this,void 0,void 0,function*(){return yield new Promise((i,r)=>n(this,void 0,void 0,function*(){yield this.fileService.writeFile(e,t),i(!0)}))})}};i([o.Inject(s.__PARCEL_BUILD_OUT_DIR),r("design:type","function"==typeof(e=void 0!==s.__PARCEL_BUILD_OUT_DIR&&s.__PARCEL_BUILD_OUT_DIR)?e:Object)],f.prototype,"parcelBuildDir",void 0),f=i([o.Service(),r("design:paramtypes",["function"==typeof(t=void 0!==c.FileService&&c.FileService)?t:Object])],f),exports.FileUserService=f;
},{"./file.service":"app/services/file/file.service.ts","../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/services/dts-generator/dts-generator.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,i,r){var o,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(n<3?o(s):n>3?o(t,i,s):o(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}},o=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,n){function s(e){try{l(r.next(e))}catch(t){n(t)}}function c(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(s,c)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),s=require("child_process"),c=require("../../../env.injection.tokens");let l=class{constructor(e,t){this.logger=e,this.node_modules=t}validateEntries(e,t,i){if(!t)throw new Error("Missing project path");if(!e)throw new Error("Missing project namespace");if(!i)throw new Error("Missing project outPath")}mergeTypings(e,t,i){return o(this,void 0,void 0,function*(){return this.validateEntries(e,t,i),new Promise((r,o)=>{this.child&&(this.child.stdout.removeAllListeners("data"),this.child.stderr.removeAllListeners("data"),this.child.removeAllListeners("exit"),this.child.kill()),process.env=Object.assign(process.env,{}),this.logger.log("Typescript merging definitions started in child process...\n"),this.child=s.spawn(`${this.node_modules}/.bin/rxdi-merge`,["--name",e,"--project",t,"--out",i]),this.child.stdout.on("data",e=>{process.argv.toString().includes("--silent")?console.log=(()=>null):process.stdout.write(e)}),this.child.stderr.on("data",e=>{e.toString().includes("Unable to resolve configuration")&&this.logger.log("If you want rxdi-deploy to create tsconfig.json for you pass parameter --tsconfig"),o(process.stdout.write(e))}),this.child.on("exit",e=>{this.child.kill(),this.child=null,this.logger.log(`Child process exited with code ${e}\n`),r(!0)})})})}};l=t([n.Service(),r(1,n.Inject(c.__NODE_MODULES)),i("design:paramtypes",["function"==typeof(e=void 0!==n.BootstrapLogger&&n.BootstrapLogger)?e:Object,String])],l),exports.TypescriptDefinitionGeneratorService=l;
},{"../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/status/status-injection.tokens.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");class t{constructor(){this.status="SUCCESS",this.message=""}}class s{constructor(){this.file=new t,this.typings=new t,this.module=new t}}exports.FILE_DEPLOYMENT_STATUS_INTERFACE=s,exports.START=new e.InjectionToken("compilation-started"),exports.FILE_DEPLOYMENT_STATUS=new e.InjectionToken("files-deploy-ment");
},{}],"app/services/table-service/table-service.ts":[function(require,module,exports) {
"use strict";var e,t,r=this&&this.__decorate||function(e,t,r,a){var n,o=arguments.length,s=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,a);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),o=require("../../status/status-injection.tokens"),s=require("../ipfs-file/ipfs-file.service"),i=require("terminal-table");let l=class{constructor(e){this.fileIpfsService=e}createGenericTableStatus(e){let t,r;return"WARNING"===e&&(t="⚠",r="yellow"),"FAILED"===e&&(t="✘",r="red"),"SUCCESS"===e&&(t="✔",r="green"),{Icon:t,Color:r}}createTable(e,t,r){r.length<1&&r.push(r[0]);const a=this.fileIpfsService.providers.ipfsOriginal,n=this.$deploymentStatus.getValue().file,o=this.$deploymentStatus.getValue().typings,s=this.$deploymentStatus.getValue().module,l=this.createGenericTableStatus(n.status),c=this.createGenericTableStatus(o.status),u=this.createGenericTableStatus(s.status),d=["","Status","File Type","Size","Gateway"];let g=[4,"6%","6%","8%","78%"];const h=[l.Icon,n.status,"Bundle",`${e[0].size} bytes`,`${a}${e[0].hash}`],p=[c.Icon,o.status,"Typings",`${t[0].size} bytes`,`${a}${t[0].hash}`],S=[u.Icon,s.status,"Module",`${r[1].size} bytes`,`${a}${r[1].hash}`];"SUCCESS"===n.status&&"SUCCESS"===o.status&&"SUCCESS"===s.status||(d.push("Errors"),g=[4,"6%","6%","8%","40%","38%"]),"SUCCESS"!==n.status&&h.push(n.message),"SUCCESS"!==o.status&&p.push(o.message),"SUCCESS"!==s.status&&S.push(s.message);const f=new i({borderStyle:2,horizontalLine:!0,width:g,rightPadding:0,leftPadding:1});return f.push(d),f.push(h),f.push(p),f.push(S),f.attrRange({row:[0,1]},{color:"green",bg:"black"}),f.attrRange({column:[0,1]},{color:"green",bg:"black"}),f.attrRange({column:[0,2],row:[0,4]},{color:"green",bg:"black"}),f.attrRange({column:[0,1],row:[0,2]},{color:"green"}),f.attrRange({column:[0,2],row:[0,2]},{color:l.Color}),f.attrRange({column:[0,2],row:[2,3]},{color:c.Color}),f.attrRange({column:[0,2],row:[3,4]},{color:u.Color}),f.attrRange({row:[1],column:[1]},{}),"SUCCESS"===n.status&&"SUCCESS"===o.status&&"SUCCESS"===s.status||(f.attrRange({column:[5,6]},{color:"red"}),f.attrRange({column:[5,6],row:[5,6]},{color:"red"})),f}previewsVersions(e){const t=new i({borderStyle:2,horizontalLine:!0,width:["50%","50%"],rightPadding:0,leftPadding:1});return t.push(["Previews versions","Gateway"]),e.forEach(e=>{t.push([e,`${this.fileIpfsService.providers.ipfsOriginal}${e}`])}),t.attrRange({row:[0,1]},{align:"center",color:"green",bg:"black"}),t.attrRange({row:[1],column:[1]},{leftPadding:5}),t}endInstallCommand(e){const t=new i({borderStyle:2,horizontalLine:!0,width:["50%"],rightPadding:0,leftPadding:1});return t.push(["Install command"]),t.push([`rxdi i ${e}`]),t.attrRange({row:[0,1]},{align:"center",color:"green",bg:"black"}),t.attrRange({row:[1],column:[1]},{leftPadding:5}),t}previewsNext(e){const t=new i({borderStyle:2,horizontalLine:!0,width:["50%","50%"],rightPadding:0,leftPadding:1});t.push(["Previews version","Next version"]);let r=!1;const a=[],n=[];return e.forEach(e=>{r?(r=!1,n.push(e)):(a.push(e),r=!0)}),a.forEach((e,r)=>{t.push([e,n[r]])}),t.attrRange({row:[0,1]},{align:"center",color:"green",bg:"black"}),t.attrRange({row:[1],column:[1]},{leftPadding:5}),t}getHistoryTable(e){const t=new i({borderStyle:2,horizontalLine:!0,width:[3,"50%","50%"],rightPadding:0,leftPadding:1});return t.push(["","Date","Hash"]),console.log(e),e.forEach(e=>{t.push(["",`${e.createdAt}`,`rxdi-deploy --find ${e.hash}`])}),t.attrRange({row:[0,1]},{align:"center",color:"green",bg:"black"}),t.attrRange({row:[1],column:[1]},{leftPadding:5}),t}fileUploadStatus(e){const t=new i({borderStyle:2,horizontalLine:!0,width:["100%"],rightPadding:0,leftPadding:1});return t.push(["File upload status"]),t.push([`File size: ${e[0].size} bytes`]),t.push([`IPFS address: ${this.fileIpfsService.providers.ipfsOriginal}${e[0].hash}`]),t.attrRange({row:[0,1]},{align:"center",color:"green",bg:"black"}),t.attrRange({row:[1],column:[1]},{leftPadding:5}),t}};r([n.Inject(o.FILE_DEPLOYMENT_STATUS),a("design:type","function"==typeof(e=void 0!==o.FILE_DEPLOYMENT_STATUS&&o.FILE_DEPLOYMENT_STATUS)?e:Object)],l.prototype,"$deploymentStatus",void 0),l=r([n.Service(),a("design:paramtypes",["function"==typeof(t=void 0!==s.FileIpfsService&&s.FileIpfsService)?t:Object])],l),exports.TableService=l;
},{"../../status/status-injection.tokens":"app/status/status-injection.tokens.ts","../ipfs-file/ipfs-file.service":"app/services/ipfs-file/ipfs-file.service.ts"}],"app/status/status.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@rxdi/core"),i=require("./status-injection.tokens");let n=class{getBuildStatus(){return this.$deploymentStatus.getValue()}setBuildStatus(e){this.$deploymentStatus.next(Object.assign({},this.$deploymentStatus.getValue(),e))}};t([r.Inject(i.FILE_DEPLOYMENT_STATUS),o("design:type","function"==typeof(e=void 0!==i.FILE_DEPLOYMENT_STATUS&&i.FILE_DEPLOYMENT_STATUS)?e:Object)],n.prototype,"$deploymentStatus",void 0),n=t([r.Service()],n),exports.StatusService=n;
},{"./status-injection.tokens":"app/status/status-injection.tokens.ts"}],"app/status/status.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,s,r){var u,c=arguments.length,o=c<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var i=e.length-1;i>=0;i--)(u=e[i])&&(o=(c<3?u(o):c>3?u(t,s,o):u(t,s))||o);return c>3&&o&&Object.defineProperty(t,s,o),o};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),s=require("rxjs"),r=require("./status-injection.tokens"),u=require("./status.service");let c=class{};c=e([t.Module({services:[u.StatusService,{provide:r.START,useValue:new s.BehaviorSubject(!0)},{provide:r.FILE_DEPLOYMENT_STATUS,useValue:new s.BehaviorSubject({file:{status:"SUCCESS",message:"success"},typings:{status:"SUCCESS",message:"success"},module:{status:"SUCCESS",message:"success"}})}]})],c),exports.StatusModule=c;
},{"./status-injection.tokens":"app/status/status-injection.tokens.ts","./status.service":"app/status/status.service.ts"}],"app/services/build-history/build-history.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,r,i){var a,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(n<3?a(o):n>3?a(t,r,o):a(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("@rxdi/core"),a=require("rxjs"),n=require("../../../env.injection.tokens");let o=class{insert(e){return new a.Observable(t=>{this.buildHistoryDatabase.insert(e,(e,r)=>{if(e)throw new Error("Unable to insert to database");t.next(r)})})}find(e){return new a.Observable(t=>{this.buildHistoryDatabase.find(e,(e,r)=>{e&&t.error(e),t.next(r)})})}findAll(e=0,t=100,r={createdAt:-1},i={}){return new Promise((a,n)=>{this.buildHistoryDatabase.find(i).sort(r).skip(e).limit(t).exec((e,t)=>{e&&n(e),a(t.map(e=>(e.createdAt=new Date(e.createdAt).valueOf(),e)).sort((e,t)=>t.createdAt-e.createdAt).map(e=>(e.createdAt=new Date(e.createdAt),e)))})})}};t([i.Inject(n.__BUILD_HISTORY_DATABASE),r("design:type","function"==typeof(e=void 0!==n.__BUILD_HISTORY_DATABASE&&n.__BUILD_HISTORY_DATABASE)?e:Object)],o.prototype,"buildHistoryDatabase",void 0),o=t([i.Service()],o),exports.BuildHistoryService=o;
},{"../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/services/error-reason/error-reason.service.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,o){var i,c=arguments.length,n=c<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,r,t,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(n=(c<3?i(n):c>3?i(r,t,n):i(r,t))||n);return c>3&&n&&Object.defineProperty(r,t,n),n};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@rxdi/core");let t=class{moduleIntegrityError(e,r){console.log(`Module is with the same integrity like in the previws version ${e}`),console.log(`To check this version write down following command rxdi-deploy --find ${r}`)}};t=e([r.Service()],t),exports.ErrorReasonService=t;
},{}],"app/services/previous/previous.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("@rxdi/core"),n=require("rxjs"),o=require("../../../env.injection.tokens");let a=class{insert(e){return new n.Observable(t=>{this.previwsDatabase.insert(e,(e,r)=>{if(e)throw new Error("Unable to insert to database");t.next(r)})})}find(e){return new n.Observable(t=>{this.previwsDatabase.find(e,(e,r)=>{e&&t.error(e),t.next(r)})})}};t([i.Inject(o.__PREVIWS_DATABASE),r("design:type","function"==typeof(e=void 0!==o.__PREVIWS_DATABASE&&o.__PREVIWS_DATABASE)?e:Object)],a.prototype,"previwsDatabase",void 0),a=t([i.Service()],a),exports.PreviousService=a;
},{"../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/services/package-json/package-json.service.ts":[function(require,module,exports) {
"use strict";var e,t,i=this&&this.__decorate||function(e,t,i,n){var r,c=arguments.length,o=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(c<3?r(o):c>3?r(t,i,o):r(t,i))||o);return c>3&&o&&Object.defineProperty(t,i,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}},c=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,c){function o(e){try{u(n.next(e))}catch(t){c(t)}}function s(e){try{u(n.throw(e))}catch(t){c(t)}}function u(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,s)}u((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("../file/file.service"),s=require("@rxdi/core"),u=require("../../../env.injection.tokens"),f=require("../helpers/helpers");let a=class{constructor(e,t){this.fileService=e,this.deployerOutputConfigName=t}OnInit(){f.includes("--collect-packages")?this.defaultOutputConfig="package.json":this.defaultOutputConfig=this.deployerOutputConfigName}prepareDependencies(e){return c(this,void 0,void 0,function*(){const t=yield this.read(e);return t.dependencies?Object.keys(t.dependencies).map(e=>({name:e,version:t.dependencies[e]})):[]})}readModifyWrite(e={},t){return c(this,void 0,void 0,function*(){let i=yield this.read(t);return i=Object.assign({},e,i),yield this.write(i,t)})}read(e){return c(this,void 0,void 0,function*(){return JSON.parse(yield this.fileService.readFile(e||`${process.cwd()}/${this.defaultOutputConfig}`))})}write(e,t){return c(this,void 0,void 0,function*(){return yield this.fileService.writeFile(t||`${process.cwd()}/${this.defaultOutputConfig}`,JSON.stringify(e))})}};a=i([s.Service(),r(1,s.Inject(u.__DEPLOYER_OUTPUT_CONFIG_NAME)),n("design:paramtypes",["function"==typeof(e=void 0!==o.FileService&&o.FileService)?e:Object,"function"==typeof(t=void 0!==u.__DEPLOYER_OUTPUT_CONFIG_NAME&&u.__DEPLOYER_OUTPUT_CONFIG_NAME)?t:Object])],a),exports.PackageJsonService=a;
},{"../file/file.service":"app/services/file/file.service.ts","../../../env.injection.tokens":"env.injection.tokens.ts","../helpers/helpers":"app/services/helpers/helpers.ts"}],"app/server/namespace/services/namespace.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,n,i){var r,c=arguments.length,o=c<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(c<3?r(o):c>3?r(t,n,o):r(t,n))||o);return c>3&&o&&Object.defineProperty(t,n,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}s((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@rxdi/core"),c=require("../../../../env.injection.tokens");let o=class{getNamespace(e){return new Promise((t,n)=>{this.namespace.find({name:e}).exec((e,i)=>{e&&n(e),t(i)})})}getNamespaceById(e){return new Promise((t,n)=>{this.namespace.findOne({_id:e},(e,i)=>{e&&n(e),console.log(i),t(i)})})}searchForDuplicates(e){return new Promise((t,n)=>{this.namespace.findOne({name:e},(e,i)=>{e&&n(e),t(i)})})}insert(e){return i(this,void 0,void 0,function*(){return yield new Promise((t,n)=>{this.namespace.insert(e,(e,i)=>{e&&n(e),t(i)})})})}listNamespaces(e=0,t=100,n={createdAt:-1}){return new Promise((i,r)=>{this.namespace.find({}).sort(n).skip(e).limit(t).exec((e,t)=>{e&&r(e),i(t)})})}};t([r.Inject(c.__NAMESPACE_DB),n("design:type","function"==typeof(e=void 0!==c.__NAMESPACE_DB&&c.__NAMESPACE_DB)?e:Object)],o.prototype,"namespace",void 0),o=t([r.Service()],o),exports.NamespaceService=o;
},{"../../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/services/time/time.service.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,c){var a,o=arguments.length,n=o<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,c);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(n=(o<3?a(n):o>3?a(t,r,n):a(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core");let r=class{calculateTime(e){const t=new Date(e);return{day:this.getDay(t),month:this.getDay(t),year:this.getDay(t)}}getDay(e){return e.getUTCDate()}getMonth(e){return e.getUTCDate()}getYear(e){return e.getUTCFullYear()}};r=e([t.Service()],r),exports.TimeService=r;
},{}],"app/services/html-template-builder/html-template-builder.service.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,c){var o,l=arguments.length,i=l<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,c);else for(var n=e.length-1;n>=0;n--)(o=e[n])&&(i=(l<3?o(i):l>3?o(t,r,i):o(t,r))||i);return l>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core");let r=class{};r=e([t.Service()],r),exports.HtmlTemplateBuilder=r;
},{}],"app/services/index.ts":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./file/file-user.service")),e(require("./file/file.service")),e(require("./ipfs-file/ipfs-file.service")),e(require("./parcel-bundler/parcel-bundler.service")),e(require("./arguments/arguments.service")),e(require("./dts-generator/dts-generator.service")),e(require("./tsconfig-generator/tsconfig-generator.service")),e(require("./table-service/table-service")),e(require("./build-history/build-history.service")),e(require("./previous/previous.service")),e(require("./error-reason/error-reason.service")),e(require("./time/time.service")),e(require("./package-json/package-json.service")),e(require("./html-template-builder/html-template-builder.service")),e(require("./helpers/helpers")),e(require("./logger/logger.service"));
},{"./file/file-user.service":"app/services/file/file-user.service.ts","./file/file.service":"app/services/file/file.service.ts","./ipfs-file/ipfs-file.service":"app/services/ipfs-file/ipfs-file.service.ts","./parcel-bundler/parcel-bundler.service":"app/services/parcel-bundler/parcel-bundler.service.ts","./arguments/arguments.service":"app/services/arguments/arguments.service.ts","./dts-generator/dts-generator.service":"app/services/dts-generator/dts-generator.service.ts","./tsconfig-generator/tsconfig-generator.service":"app/services/tsconfig-generator/tsconfig-generator.service.ts","./table-service/table-service":"app/services/table-service/table-service.ts","./build-history/build-history.service":"app/services/build-history/build-history.service.ts","./previous/previous.service":"app/services/previous/previous.service.ts","./error-reason/error-reason.service":"app/services/error-reason/error-reason.service.ts","./time/time.service":"app/services/time/time.service.ts","./package-json/package-json.service":"app/services/package-json/package-json.service.ts","./html-template-builder/html-template-builder.service":"app/services/html-template-builder/html-template-builder.service.ts","./helpers/helpers":"app/services/helpers/helpers.ts","./logger/logger.service":"app/services/logger/logger.service.ts"}],"app/server/file/services/file.service.ts":[function(require,module,exports) {
"use strict";var e,i=this&&this.__decorate||function(e,i,t,r){var o,s=arguments.length,n=s<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,i,t,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(n=(s<3?o(n):s>3?o(i,t,n):o(i,t))||n);return s>3&&n&&Object.defineProperty(i,t,n),n},t=this&&this.__metadata||function(e,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,i)},r=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))(function(o,s){function n(e){try{c(r.next(e))}catch(i){s(i)}}function l(e){try{c(r.throw(e))}catch(i){s(i)}}function c(e){e.done?o(e.value):new t(function(i){i(e.value)}).then(n,l)}c((r=r.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("@rxdi/core"),s=require("rxjs/operators"),n=require("fs"),l=require("../../../services"),c=require("path"),a=require("rxjs"),u=require("util"),d=require("../../../../env.injection.tokens"),h=require("@rxdi/core/dist/services/file/dist"),p=require("ncp").ncp,f=require("rimraf");let y=class{constructor(){this.units=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],this.results=[]}wholeReadDirRecursive(e="."){return r(this,void 0,void 0,function*(){const i=yield this.readDir(e),t=e,o=this;return(yield Promise.all(i.map(e=>r(this,void 0,void 0,function*(){const i=c.resolve(t,e),r=yield this.statAsync(i);if(r&&r.isDirectory()){if(e.includes("node_modules"))return null;yield o.wholeReadDirRecursive.bind(this)(i)}else this.results=[...this.results,i]})))).filter(e=>!!e)})}readCurrentDirFlat(e="."){return r(this,void 0,void 0,function*(){return(yield this.readDir(e)).map(i=>c.resolve(e,i)).filter(e=>!!e)})}listFolder(e){return r(this,void 0,void 0,function*(){return yield new Promise((i,t)=>{a.from(this.readCurrentDirFlat(e)).pipe(s.switchMap(e=>this.map(e))).subscribe(e=>i(e),e=>t(e))})})}readDir(e,i=200){return r(this,void 0,void 0,function*(){return yield new Promise((t,r)=>{n.readdir(e,(e,r)=>{if(e)t([]);else{let e=0;t(r.map(t=>i>++e?t:null).filter(e=>!!e))}})})})}map(e){return r(this,void 0,void 0,function*(){let i=0;return(yield Promise.all(e.map(e=>r(this,void 0,void 0,function*(){i++;const t={path:e,directory:null,file:null,name:null,status:null},r=yield this.statAsync(e);return!r.isDirectory||r&&r.prototype===String?null:(r.isDirectory()?t.directory=!0:t.file=!0,t.name=e.split("/").pop(),t.path=(i=>e.replace(process.cwd(),i))("."),l.includes("--enable-full-folder-access")&&(t.path=e),t.status=r,t.status.size=this.niceBytes(r.size),100===i?null:t)})))).filter(e=>!!e)})}niceBytes(e){let i=0,t=parseInt(e,10)||0;for(;t>=1024&&++i;)t/=1024;return t.toFixed(t>=10||i<1?0:1)+" "+this.units[i]}statAsync(e){return r(this,void 0,void 0,function*(){return yield new Promise((i,t)=>{n.stat(e,(e,t)=>{e&&i(e),i(t)})})})}moveFile(e,i){return a.from(u.promisify(n.rename)(e,i||`${this.homeDir}/.rxdi/builds`))}ensureDir(e){return new Promise((i,t)=>{h.mkdirp(e,e=>{e?(console.error(e),t(e)):i()})})}getFolderFromPath(e){return e.substring(0,e.lastIndexOf("/"))}copyTransactionFiles(e,i,t){return r(this,void 0,void 0,function*(){const r=(e,i)=>`${e}/${i}`,{saveFolder:o,originalFilePath:s,filePath:n}=this.prepareCopyData(e,i,t);yield this.copyFolderRecursive(this.getFolderFromPath(s),this.getFolderFromPath(o));const l=r(i,"reactive.json"),a=r(n,"reactive.json"),u=c.normalize(r(i,t));let d=!1;yield this.ensureDir(this.getFolderFromPath(o)),(yield this.isFileExist(u))&&(yield this.copyFile(u,o)),(yield this.isFileExist(l))&&(yield this.copyFile(l,a),d=!0),d||console.error("Missing package.json or reactive.json bundle will proceed but if you depend on some modules you cannot use them since they will not be installed")})}prepareCopyData(e,i,t){const r=`${this.homeDir}/.rxdi/builds/${e}`,o=c.normalize(`${i}/${t}`),s=c.normalize(`${r}/${t}`),n=o.replace(/^.*[\\\/]/,""),l=s.replace(n,"");return{saveFolder:s,originalFilePath:o,transactionFolder:r,filename:n,filePath:l}}removeTransaction(e,i,t){const{transactionFolder:r}=this.prepareCopyData(e,i,t);return a.from(new Promise(e=>f(r,e)))}removeFile(e){return e=c.normalize(e),a.from(u.promisify(n.unlink)(e))}copyFile(e,i){return u.promisify(n.copyFile)(e,i)}isFileExist(e){return u.promisify(n.exists)(e)}copyFolderRecursive(e,i){return new Promise((t,r)=>{console.log("WHY"),p(e,i,function(e){if(console.log(e),e)return r(e);t()})})}};i([o.Inject(d.__HOME_DIR),t("design:type","function"==typeof(e=void 0!==d.__HOME_DIR&&d.__HOME_DIR)?e:Object)],y.prototype,"homeDir",void 0),y=i([o.Service(),t("design:paramtypes",[])],y),exports.FileService=y;
},{"../../../services":"app/services/index.ts","../../../../env.injection.tokens":"env.injection.tokens.ts"}],"app/plugins/compile/template.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.templateHtml=((e,n,t="container")=>`\n<!DOCTYPE html>\n<div id="meta-rxdi-ipfs-module" style="visibility:hidden;z-index:-10000;position:absolute;">\n\x3c!--meta-rxdi-ipfs-module--\x3e\n${JSON.stringify(e,null,2)}\n\x3c!--meta-rxdi-ipfs-module--\x3e\n</div>\n<html lang="en">\n  <head>\n    <meta charset="utf-8" />\n    <meta\n      name="viewport"\n      content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=no"\n    />\n    <title>@rxdi client side example</title>\n    <meta name="theme-color" content="#33383a" />\n    <style>\n      body {\n        margin: 0px;\n        padding: 0px;\n        color: #f8f8f8;\n        font-family: 'Roboto', sans-serif;\n        background-color: #1c1f24;\n        overflow-y: scroll;\n      }\n      a {\n        color: cornflowerblue;\n      }\n    </style>\n    <base href="/" />\n    \x3c!-- iOS --\x3e\n    <meta name="mobile-web-app-capable" content="yes" />\n    <meta name="mobile-web-app-status-bar-style" content="black" />\n    <meta name="mobile-web-app-title" content="Expenses" />\n  </head>\n  <body>\n    <div id="${t}"></div>\n    <script src="${n}"><\/script>\n  </body>\n</html>\n\n`);
},{}],"app/plugins/compile/compile.plugin.ts":[function(require,module,exports) {
"use strict";var e,i,t,s,r,o,n,l,a,c,d,p,h,u,g,f,v,m,y,S,b,w,_=this&&this.__decorate||function(e,i,t,s){var r,o=arguments.length,n=o<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,t):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,i,t,s);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(n=(o<3?r(n):o>3?r(i,t,n):r(i,t))||n);return o>3&&n&&Object.defineProperty(i,t,n),n},M=this&&this.__metadata||function(e,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,i)},O=this&&this.__awaiter||function(e,i,t,s){return new(t||(t=Promise))(function(r,o){function n(e){try{a(s.next(e))}catch(i){o(i)}}function l(e){try{a(s.throw(e))}catch(i){o(i)}}function a(e){e.done?r(e.value):new t(function(i){i(e.value)}).then(n,l)}a((s=s.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const F=require("../../../env.injection.tokens"),$=require("@rxdi/core"),I=require("rxjs/operators"),E=require("rxjs"),N=require("../../services/file/file-user.service"),T=require("../../services/parcel-bundler/parcel-bundler.service"),j=require("../../services/ipfs-file/ipfs-file.service"),x=require("../../services/file/file.service"),A=require("../../services/dts-generator/dts-generator.service"),B=require("../../services/tsconfig-generator/tsconfig-generator.service"),C=require("../../services/table-service/table-service"),P=require("../../services/build-history/build-history.service"),R=require("../../services/previous/previous.service"),D=require("../../services/error-reason/error-reason.service"),k=require("../../status/status.service"),q=require("../../services/package-json/package-json.service"),G=require("../../services/helpers/helpers"),L=require("../../server/namespace/services/namespace.service"),U=require("../../server/file/services/file.service"),J=require("path"),H=require("./template");let z=class{constructor(e,i,t,s,r,o,n,l,a,c,d,p,h,u,g){this.parcelBundler=e,this.logger=i,this.ipfsFile=t,this.fileService=s,this.fileUserService=r,this.typingsGenerator=o,this.tsConfigGenerator=n,this.tableService=l,this.buildHistoryService=a,this.previousService=c,this.namespaceService=d,this.errorReasonService=p,this.statusService=h,this.packageJsonService=u,this.internalFileService=g,this.fileNotDeployed="",this.initIpfsModule=[{size:0,hash:this.fileNotDeployed,path:this.fileNotDeployed,content:this.fileNotDeployed}]}register(){return O(this,void 0,void 0,function*(){return G.includes("--webui")||G.includes("--node-only")?yield Promise.resolve():this.isJavascriptCompilation()?yield this.compile():yield new Promise(e=>{this.writeOtherFile(`${this.folder}${this.fileName}`).pipe(I.tap(e=>this.logSuccess(e)),I.switchMapTo(E.interval(1e3)),I.take(this.resolutionTime),I.map(e=>this.resolutionTime-1-e)).subscribe(i=>{i||(e(!0),process.exit(0))},e=>{this.logger.error(e),process.exit(1)})})})}isJavascriptCompilation(){return!![".ts",".js",".tsx"].filter(e=>e===this.extension).length}compile(){return O(this,void 0,void 0,function*(){return this.completeBuildAndAddToIpfs(this.folder,this.fileName,this.commitMessage,this.namespace,this.outputConfigName).pipe(I.tap(e=>this.logSuccess(e)),I.switchMapTo(E.interval(1e3)),I.take(this.resolutionTime),I.map(e=>this.resolutionTime-1-e)).subscribe(e=>{e||process.exit(0)},e=>{this.logger.error(e),process.exit(1)})})}parcelBuild(e,i=null,t){return console.log(i),this.parcelBundler.prepareBundler(e,i,t)}createCommitMessage(e=""){return O(this,void 0,void 0,function*(){if(G.includes("--html-message")){let e;const t=G.nextOrDefault("--html-message","./index.html");try{e=yield this.fileService.readFileRaw(t)}catch(i){console.log(`\nError loading file ${t}\n                `),process.exit(0)}return yield this.ipfsFile.addRawFile(e)}return!e||e.includes("--")||e.includes("-")?yield Promise.resolve(this.initIpfsModule):yield this.ipfsFile.addFile(e)})}completeBuildAndAddToIpfs(e,i,t,s,r,o="./build"){let n,l,a=this.initIpfsModule,c=this.initIpfsModule;const d=this.initIpfsModule;let p,h;return this.logger.log("Bundling Started!\n"),E.from(this.parcelBuild(J.normalize(e+"/"+i),o,`${i.split(".")[0]}.js`)).pipe(I.tap(()=>{this.logger.log("Bundling finished!\n"),this.logger.log(`Adding commit message ${t}...\n`)}),I.switchMap(()=>O(this,void 0,void 0,function*(){return this.createCommitMessage(t)})),I.tap(e=>{c=e,this.logger.log("Commit message added...\n")}),I.switchMap(()=>this.fileService.readFile(`${o}/${i.split(".")[0]}.js`)),I.tap(()=>{this.logger.log(`Reading bundle ${o}/${i.split(".")[0]}.js finished!\n`)}),I.switchMap(e=>this.ipfsFile.addFile(e)),I.tap(e=>{n=e,this.logger.log(`Bundle added to ipfs ${o}/${i.split(".")[0]}.js\n`),this.logger.log("Typescript definitions merge started!\n")}),I.switchMap(()=>E.from(this.typingsGenerator.mergeTypings(s,e,`${o}/index.d.ts`))),I.tap(()=>this.logger.log("Typescript definitions merge finished! Reading file...\n")),I.switchMap(()=>this.fileService.readFile(`${o}/index.d.ts`)),I.tap(()=>this.logger.log("Typescript definitions read finished! Adding to IPFS...\n")),I.switchMap(e=>e?this.ipfsFile.addFile(e):(this.statusService.setBuildStatus({typings:{status:"WARNING",message:"Missing typescript definition.Typings will not be uploaded!"}}),Promise.resolve(this.initIpfsModule))),I.tap(e=>{(a=e)[0].hash&&this.logger.log("Typescript definitions added to IPFS! Adding module configuration...\n")}),I.switchMap(()=>this.fileService.readFilePromisifyFallback(`${e}/${r}`)),I.switchMap(i=>O(this,void 0,void 0,function*(){try{h=JSON.parse(i)}catch(u){throw new Error(`Cannot parse ${r} from root directory!`)}p={name:s,module:n[0].hash,createdAt:new Date},a[0].hash&&(p.typings=a[0].hash),c[0].hash&&(p.message=c[0].hash),d[0].hash&&(p.metadata=d[0].hash),p.previous=[...h.previous||[]];let t,o={ipfs:[]};if(yield this.internalFileService.statAsync(`${e}/${r}`)){this.logger.log(`Reactive file present ${r} package dependencies will be taken from it`);try{o=JSON.parse(yield this.fileService.readFile(`${e}/${r}`))}catch(u){throw new Error(`Cannot parce reactive file at ${e}/${r}`)}o.dependencies&&(p.dependencies=o.dependencies);const i=[];o.ipfs&&o.ipfs.length&&(o.ipfs.forEach(e=>e.dependencies.forEach(e=>i.push(e))),i.length&&(p.dependencies=i))}if(this.logger.log(`Current module before deploy ${JSON.stringify(p)}`),G.includes("--collect-packages")){const i=yield this.packageJsonService.prepareDependencies(`${e}/package.json`);i.length&&(p.packages=i)}return G.includes("--html")&&(yield this.parcelBundler.prepareBundler(G.nextOrDefault("--html",""),"index"),t=yield this.fileService.readFile(G.nextOrDefault("--html",""))),l=yield this.ipfsFile.addFile(`\n          ${H.templateHtml(p,G.nextOrDefault("--customComponent","https://gitcdn.xyz/repo/rxdi/ui-registry/master/my-project/module-view/build/module-view.js"))}\n          ${t||""}\n          `,{path:`${s}/index.html`}),console.log(l),p.previous.length>=20&&p.previous.shift(),p.previous=[...p.previous,l[1].hash],o.ipfs&&(p.ipfs=o.ipfs),yield this.fileUserService.writeDag(`${e}/${r}`,JSON.stringify(p,null,2)),l})),I.tap(()=>this.logger.log("Module configuration added to ipfs!\n")),I.switchMap(()=>O(this,void 0,void 0,function*(){let e=yield this.namespaceService.searchForDuplicates(s);return e||(e=yield this.namespaceService.insert({name:s})),e})),I.switchMap(e=>E.combineLatest([this.buildHistoryService.insert({status:{file:this.statusService.getBuildStatus().file,typings:this.statusService.getBuildStatus().typings,module:this.statusService.getBuildStatus().module},hash:l[1].hash,name:s,typings:a[0].hash,module:n[0].hash,metadata:d[0].hash,message:c[0].hash,namespaceId:e._id}),this.previousService.insert({name:s,hash:l[1].hash})])),I.map(()=>({file:n,typings:a,module:l})),I.tap(()=>O(this,void 0,void 0,function*(){this.logger.log("Module saved to persistant history!"),l||this.fileNotAddedToIpfs(l),console.log(""+this.tableService.previewsVersions(p.previous)),console.log(""+this.tableService.previewsNext(p.previous)),console.log(""+this.tableService.endInstallCommand(l[1].hash)),console.log(""+this.tableService.createTable(n,a,l));const e=e=>p.previous[p.previous.length-e];yield this.showError(e(2),e(1))})))}fileNotAddedToIpfs(e){console.log(`File not added to ipfs for ${JSON.stringify(e)}`),console.log(`More info can be found executing command: rxdi-deploy --find ${e[0].hash}`)}integrityCheck(e,i,t){const s="Integrity is same like in the previews version!";console.log(e.module,i[0].hash),e.module===i[0].hash&&(this.logger.log("\n        !! Warning !!\n        Module is with the same integrity and will not be uploaded again!\n        You need to make change to the module so it will be with different integrity!\n            "),this.statusService.setBuildStatus({file:{status:"WARNING",message:s},module:{status:"WARNING",message:s}})),e.typings===t[0].hash&&(this.logger.log("\n        !! Warning !!\n        Typings are with the same integrity and will not be uploaded again!\n        You need to make change to the module so it will be with different integrity!\n            "),this.statusService.setBuildStatus({typings:{status:"WARNING",message:s}}))}showError(e,i){return O(this,void 0,void 0,function*(){return yield new Promise(t=>{Object.keys(this.statusService.getBuildStatus()).filter(e=>"SUCCESS"!==this.statusService.getBuildStatus()[e].status).length&&this.errorReasonService.moduleIntegrityError(e,i),setTimeout(()=>{t()},1e3)})})}writeOtherFile(e){return E.from(this.fileService.readFileRaw(e)).pipe(I.switchMap(e=>this.ipfsFile.addRawFile(e)),I.tap(e=>{console.log(""+this.tableService.fileUploadStatus(e))}))}logSuccess(e){console.log(`Deploy finish ipfs node will shutdown in: ${this.resolutionTime} seconds`)}completeBuildAndAddToIpfs2(e="@gapi/core"){let i;return E.from(this.fileUserService.writeFile("\nimport { Service } from '@rxdi/core';\n\n@Service()\nexport class Pesho {\n    constructor() {\n        console.log('THIS IS PESHO SERVICE');\n    }\n}\n\n        ","index.ts",e)).pipe(I.switchMap(()=>E.from(this.fileUserService.writeFile(this.tsConfigGenerator.getTsConfig("index"),"tsconfig.json",e))),I.switchMap(()=>E.from(this.parcelBundler.prepareBundler(`./build/${e}/index.ts`))),I.switchMap(()=>this.fileService.readFile("./build/index.js")),I.switchMap(e=>this.ipfsFile.addFile(e)),I.tap(e=>i=e),I.switchMap(()=>E.from(this.typingsGenerator.mergeTypings(e,`./build/${e}`,"./build/index.d.ts"))),I.switchMap(()=>E.of(i)))}pushTransaction(e,i,t,s,r,o="./build"){let n,l,a=this.initIpfsModule,c=this.initIpfsModule;const d=this.initIpfsModule;let p,h;this.logger.log("Bundling Started!\n");const u=i;return"."===i[0]&&(i=i.substr(1)),console.log(i),i=i.replace(/^.*[\\\/]/,""),console.log(i),E.from(this.parcelBuild(J.normalize(e+"/"+u),`${e}/${o}`,`${i.split(".")[0]}.js`)).pipe(I.tap(()=>{this.logger.log("Bundling finished!\n"),this.logger.log(`Adding commit message ${t}...\n`)}),I.switchMap(()=>O(this,void 0,void 0,function*(){return this.createCommitMessage(t)})),I.tap(e=>{c=e,this.logger.log("Commit message added...\n")}),I.switchMap(()=>this.fileService.readFile(`${e}/${o}/${i.split(".")[0]}.js`)),I.tap(()=>{this.logger.log(`Reading bundle ${e}/${o}/${i.split(".")[0]}.js finished!\n`)}),I.switchMap(e=>this.ipfsFile.addFile(e)),I.tap(t=>{n=t,this.logger.log(`Bundle added to ipfs ${e}/${o}/${i.split(".")[0]}.js\n`),this.logger.log("Typescript definitions merge started!\n")}),I.switchMap(()=>E.from(this.typingsGenerator.mergeTypings(s,J.normalize(e+u.substring(0,u.lastIndexOf("/")).replace(".","")),J.normalize(`${e}/${o}/index.d.ts`)))),I.tap(()=>this.logger.log("Typescript definitions merge finished! Reading file...\n")),I.switchMap(()=>this.fileService.readFile(`${e}/${o}/index.d.ts`)),I.tap(()=>this.logger.log("Typescript definitions read finished! Adding to IPFS...\n")),I.switchMap(e=>e?this.ipfsFile.addFile(e):(this.statusService.setBuildStatus({typings:{status:"WARNING",message:"Missing typescript definition.Typings will not be uploaded!"}}),Promise.resolve(this.initIpfsModule))),I.tap(e=>{(a=e)[0].hash&&this.logger.log("Typescript definitions added to IPFS! Adding module configuration...\n")}),I.switchMap(()=>this.fileService.readFilePromisifyFallback(`${e}/${r}`)),I.switchMap(i=>O(this,void 0,void 0,function*(){try{h=JSON.parse(i)}catch(u){throw new Error(`Cannot parse ${r} from root directory!`)}p={name:s,module:n[0].hash,createdAt:new Date},a[0].hash&&(p.typings=a[0].hash),c[0].hash&&(p.message=c[0].hash),d[0].hash&&(p.metadata=d[0].hash),p.previous=[...h.previous||[]];let t,o={ipfs:[]};if(yield this.internalFileService.statAsync(`${e}/${r}`)){this.logger.log(`Reactive file present ${r} package dependencies will be taken from it`);try{o=JSON.parse(yield this.fileService.readFile(`${e}/${r}`))}catch(u){throw new Error(`Cannot parce reactive file at ${e}/${r}`)}o.dependencies&&(p.dependencies=o.dependencies);const i=[];o.ipfs&&o.ipfs.length&&(o.ipfs.forEach(e=>e.dependencies.forEach(e=>i.push(e))),i.length&&(p.dependencies=i))}if(this.logger.log(`Current module before deploy ${JSON.stringify(p)}`),G.includes("--collect-packages")){const i=yield this.packageJsonService.prepareDependencies(`${e}/package.json`);i.length&&(p.packages=i)}return G.includes("--html")&&(yield this.parcelBundler.prepareBundler(G.nextOrDefault("--html",""),"index"),t=yield this.fileService.readFile(G.nextOrDefault("--html",""))),l=yield this.ipfsFile.addFile(`\n          ${H.templateHtml(p,G.nextOrDefault("--customComponent","https://gitcdn.xyz/repo/rxdi/ui-registry/master/my-project/module-view/build/module-view.js"))}\n          ${t||""}\n          `,{path:`${s}/index.html`}),p.previous.length>=20&&p.previous.shift(),p.previous=[...p.previous,l[0].hash],o.ipfs&&(p.ipfs=o.ipfs),yield this.fileUserService.writeDag(`${e}/${r}`,JSON.stringify(p,null,2)),l})),I.tap(()=>this.logger.log("Module configuration added to ipfs!\n")),I.switchMap(()=>O(this,void 0,void 0,function*(){let e=yield this.namespaceService.searchForDuplicates(s);return e||(e=yield this.namespaceService.insert({name:s})),e})),I.switchMap(e=>E.combineLatest([this.buildHistoryService.insert({status:{file:this.statusService.getBuildStatus().file,typings:this.statusService.getBuildStatus().typings,module:this.statusService.getBuildStatus().module},hash:l[0].hash,name:s,typings:a[0].hash,module:n[0].hash,metadata:d[0].hash,message:c[0].hash,namespaceId:e._id}),this.previousService.insert({name:s,hash:l[0].hash})])),I.map(()=>({file:n,typings:a,module:l})),I.tap(()=>O(this,void 0,void 0,function*(){this.logger.log("Module saved to persistant history!"),l||this.fileNotAddedToIpfs(l),console.log(""+this.tableService.previewsVersions(p.previous)),console.log(""+this.tableService.previewsNext(p.previous)),console.log(""+this.tableService.endInstallCommand(l[0].hash)),console.log(""+this.tableService.createTable(n,a,l));const e=e=>p.previous[p.previous.length-e];yield this.showError(e(2),e(1))})))}};_([$.Inject(F.__FILE_NAME),M("design:type","function"==typeof(e=void 0!==F.__FILE_NAME&&F.__FILE_NAME)?e:Object)],z.prototype,"fileName",void 0),_([$.Inject(F.__FOLDER),M("design:type","function"==typeof(i=void 0!==F.__FOLDER&&F.__FOLDER)?i:Object)],z.prototype,"folder",void 0),_([$.Inject(F.__IPFS_NODE_RESOLUTION_TIME),M("design:type","function"==typeof(t=void 0!==F.__IPFS_NODE_RESOLUTION_TIME&&F.__IPFS_NODE_RESOLUTION_TIME)?t:Object)],z.prototype,"resolutionTime",void 0),_([$.Inject(F.__DEPLOYER_OUTPUT_CONFIG_NAME),M("design:type","function"==typeof(s=void 0!==F.__DEPLOYER_OUTPUT_CONFIG_NAME&&F.__DEPLOYER_OUTPUT_CONFIG_NAME)?s:Object)],z.prototype,"outputConfigName",void 0),_([$.Inject(F.__NAMESPACE),M("design:type","function"==typeof(r=void 0!==F.__NAMESPACE&&F.__NAMESPACE)?r:Object)],z.prototype,"namespace",void 0),_([$.Inject(F.__COMMIT_MESSAGE),M("design:type","function"==typeof(o=void 0!==F.__COMMIT_MESSAGE&&F.__COMMIT_MESSAGE)?o:Object)],z.prototype,"commitMessage",void 0),_([$.Inject(F.__FILE_EXTENSION),M("design:type","function"==typeof(n=void 0!==F.__FILE_EXTENSION&&F.__FILE_EXTENSION)?n:Object)],z.prototype,"extension",void 0),z=_([$.Plugin(),M("design:paramtypes",["function"==typeof(l=void 0!==T.ParcelBundlerService&&T.ParcelBundlerService)?l:Object,"function"==typeof(a=void 0!==$.BootstrapLogger&&$.BootstrapLogger)?a:Object,"function"==typeof(c=void 0!==j.FileIpfsService&&j.FileIpfsService)?c:Object,"function"==typeof(d=void 0!==x.FileService&&x.FileService)?d:Object,"function"==typeof(p=void 0!==N.FileUserService&&N.FileUserService)?p:Object,"function"==typeof(h=void 0!==A.TypescriptDefinitionGeneratorService&&A.TypescriptDefinitionGeneratorService)?h:Object,"function"==typeof(u=void 0!==B.TsConfigGenratorService&&B.TsConfigGenratorService)?u:Object,"function"==typeof(g=void 0!==C.TableService&&C.TableService)?g:Object,"function"==typeof(f=void 0!==P.BuildHistoryService&&P.BuildHistoryService)?f:Object,"function"==typeof(v=void 0!==R.PreviousService&&R.PreviousService)?v:Object,"function"==typeof(m=void 0!==L.NamespaceService&&L.NamespaceService)?m:Object,"function"==typeof(y=void 0!==D.ErrorReasonService&&D.ErrorReasonService)?y:Object,"function"==typeof(S=void 0!==k.StatusService&&k.StatusService)?S:Object,"function"==typeof(b=void 0!==q.PackageJsonService&&q.PackageJsonService)?b:Object,"function"==typeof(w=void 0!==U.FileService&&U.FileService)?w:Object])],z),exports.CompilePlugin=z;
},{"../../../env.injection.tokens":"env.injection.tokens.ts","../../services/file/file-user.service":"app/services/file/file-user.service.ts","../../services/parcel-bundler/parcel-bundler.service":"app/services/parcel-bundler/parcel-bundler.service.ts","../../services/ipfs-file/ipfs-file.service":"app/services/ipfs-file/ipfs-file.service.ts","../../services/file/file.service":"app/services/file/file.service.ts","../../services/dts-generator/dts-generator.service":"app/services/dts-generator/dts-generator.service.ts","../../services/tsconfig-generator/tsconfig-generator.service":"app/services/tsconfig-generator/tsconfig-generator.service.ts","../../services/table-service/table-service":"app/services/table-service/table-service.ts","../../services/build-history/build-history.service":"app/services/build-history/build-history.service.ts","../../services/previous/previous.service":"app/services/previous/previous.service.ts","../../services/error-reason/error-reason.service":"app/services/error-reason/error-reason.service.ts","../../status/status.service":"app/status/status.service.ts","../../services/package-json/package-json.service":"app/services/package-json/package-json.service.ts","../../services/helpers/helpers":"app/services/helpers/helpers.ts","../../server/namespace/services/namespace.service":"app/server/namespace/services/namespace.service.ts","../../server/file/services/file.service":"app/server/file/services/file.service.ts","./template":"app/plugins/compile/template.ts"}],"app/server/services/webui.service.ts":[function(require,module,exports) {
"use strict";var e,t,r=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(o<3?n(c):o>3?n(t,r,c):n(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}},o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function c(e){try{u(i.next(e))}catch(t){o(t)}}function s(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(c,s)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const c=require("@rxdi/hapi"),s=require("@rxdi/core"),u=require("hapi"),a=require("../../../env.injection.tokens"),f=require("../../services");let h=class{constructor(e,t){this.server=e,this.root_folder=t}OnInit(){f.includes("--webui")&&this.register()}register(){return o(this,void 0,void 0,function*(){this.server.route({method:"GET",path:"/webui/{param*}",handler:{directory:{path:`${this.root_folder}/webui`,listing:!0,index:["index.html"]}}})})}};h=r([s.Service(),n(0,s.Inject(c.HAPI_SERVER)),n(1,s.Inject(a.__ROOT_FOLDER)),i("design:paramtypes",["function"==typeof(e=void 0!==u.Server&&u.Server)?e:Object,"function"==typeof(t=void 0!==a.__ROOT_FOLDER&&a.__ROOT_FOLDER)?t:Object])],h),exports.WebUiService=h;
},{"../../../env.injection.tokens":"env.injection.tokens.ts","../../services":"app/services/index.ts"}],"app/server/services/server-push.service.ts":[function(require,module,exports) {
"use strict";var e,t,r,i,n=this&&this.__decorate||function(e,t,r,i){var n,s=arguments.length,c=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(c=(s<3?n(c):s>3?n(t,r,c):n(t,r))||c);return s>3&&c&&Object.defineProperty(t,r,c),c},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}},o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function c(e){try{a(i.next(e))}catch(t){s(t)}}function o(e){try{a(i.throw(e))}catch(t){s(t)}}function a(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(c,o)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("@rxdi/core"),u=require("http"),h=require("hapi"),d=require("@rxdi/hapi"),f=require("rxjs"),v=require("rxjs/operators"),l=require("../../services");let p=class{constructor(e,t,r,i){this.server=e,this.exitHandler=t,this.afterStarterService=r,this.openService=i,this.sendToClient=new f.Subject,this.sendTime=new f.Subject,this.clientConnected=new f.Subject,this.exitHandler.errorHandler.subscribe(e=>o(this,void 0,void 0,function*(){return yield this.stopServerWatcher()}));const n=l.nextOrDefault("--server-push-interval",7e3,e=>Number(1e3*e));f.timer(0,n).pipe(v.tap(()=>this.sendTime.next(!0))).subscribe(),this.afterStarterService.appStarted.pipe(v.switchMapTo(this.waitXSeconds(5)),v.take(1),v.filter(()=>!this.connected),v.filter(()=>l.includes("--open-browser")),v.tap(()=>this.openService.openPage(`http://${this.server.info.address}:${this.server.info.port}/webui`))).subscribe()}waitXSeconds(e){return f.Observable.create(t=>{const r=setTimeout(()=>t.next(!0),1e3*e);return()=>clearTimeout(r)})}OnInit(){this.register()}register(){return o(this,void 0,void 0,function*(){(l.includes("--webui-server-watcher")||l.includes("--webui"))&&this.createServerWatcher()})}stopServerWatcher(){return o(this,void 0,void 0,function*(){return yield new Promise(e=>this.serverWatcher.close(()=>e()))})}createServerWatcher(){this.serverWatcher=u.createServer(this.OnRequest.bind(this)),this.serverWatcher.listen(l.nextOrDefault("--webui-server-watcher-port",8957))}OnRequest(e,t){return"/status"===e.url?(this.connected||(this.clientConnected.next(!0),t.write("data: "+JSON.stringify({response:{init:!0}})+"\n\n")),this.connected=!0,t.writeHead(200,{"Content-Type":"text/event-stream","Access-Control-Allow-Origin":"*","Cache-Control":"no-cache",Connection:"keep-alive"}),this.sendToClient.subscribe(e=>t.write("data: "+JSON.stringify(e)+"\n\n")),this.sendTime.subscribe(e=>t.write("data: "+JSON.stringify({time:(new Date).toLocaleTimeString()})+"\n\n")),this.sendTime.subscribe(e=>t.write("data: "+JSON.stringify({config:{graphql:{},hapi:this.server.info}})+"\n\n")),void e.on("end",()=>{this.connected=!1,e.destroy()})):(t.statusCode=400,t.end())}};p=n([a.Service(),c(0,a.Inject(d.HAPI_SERVER)),s("design:paramtypes",["function"==typeof(e=void 0!==h.Server&&h.Server)?e:Object,"function"==typeof(t=void 0!==a.ExitHandlerService&&a.ExitHandlerService)?t:Object,"function"==typeof(r=void 0!==a.AfterStarterService&&a.AfterStarterService)?r:Object,"function"==typeof(i=void 0!==d.OpenService&&d.OpenService)?i:Object])],p),exports.ServerPushService=p;
},{"../../services":"app/services/index.ts"}],"app/server/user/types/user.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");exports.UserType=new e.GraphQLObjectType({name:"UserType",fields:{message:{type:e.GraphQLString}}});
},{}],"app/server/user/user-queries.controller.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,r,s){var n,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(o=(i<3?n(o):i>3?n(t,r,o):n(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{u(s.next(e))}catch(t){i(t)}}function c(e){try{u(s.throw(e))}catch(t){i(t)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,c)}u((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),i=require("@gapi/core"),o=require("graphql"),c=require("./types/user.type");let u=class{constructor(e){this.pubsub=e}findUser(e,{message:t}){return s(this,void 0,void 0,function*(){return{message:t}})}subscribeToUserMessagesBasic({message:e}){return{message:e}}};t([i.Type(c.UserType),i.Query({message:{type:o.GraphQLString}}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],u.prototype,"findUser",null),t([i.Type(c.UserType),i.Subscribe(e=>e.pubsub.asyncIterator("CREATE_SIGNAL_BASIC")),i.Subscription(),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],u.prototype,"subscribeToUserMessagesBasic",null),u=t([n.Controller(),r("design:paramtypes",["function"==typeof(e=void 0!==i.PubSubService&&i.PubSubService)?e:Object])],u),exports.UserQueriesController=u;
},{"./types/user.type":"app/server/user/types/user.type.ts"}],"app/server/build/types/built-status.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");exports.BuildStatus=new e.GraphQLObjectType({name:"BuildStatus",fields:{status:{type:e.GraphQLString},message:{type:e.GraphQLString}}}),exports.BuildStatusType=new e.GraphQLObjectType({name:"BuildStatusType",fields:{file:{type:exports.BuildStatus},typings:{type:exports.BuildStatus},module:{type:exports.BuildStatus}}});
},{}],"app/server/history/types/history.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("graphql"),e=require("../../build/types/built-status.type");exports.HistoryType=new t.GraphQLObjectType({name:"HistoryType",fields:{_id:{type:t.GraphQLString},name:{type:t.GraphQLString},typings:{type:t.GraphQLString},module:{type:t.GraphQLString},metadata:{type:t.GraphQLString},message:{type:t.GraphQLString},hash:{type:t.GraphQLString},status:{type:e.BuildStatusType},namespaceId:{type:t.GraphQLString},createdAt:{type:t.GraphQLString},updatedAt:{type:t.GraphQLString}}});
},{"../../build/types/built-status.type":"app/server/build/types/built-status.type.ts"}],"app/server/history/history-subscription.controller.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("@gapi/core"),i=require("./types/history.type");let n=class{constructor(e){this.pubsub=e}listenForNewBuilds(e){return{payload:e}}};t([o.Type(i.HistoryType),o.Subscribe(e=>e.pubsub.asyncIterator("LISTEN_FOR_BUILDS")),o.Subscription(),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],n.prototype,"listenForNewBuilds",null),n=t([o.Controller(),r("design:paramtypes",["function"==typeof(e=void 0!==o.PubSubService&&o.PubSubService)?e:Object])],n),exports.HistorySubscriptionController=n;
},{"./types/history.type":"app/server/history/types/history.type.ts"}],"app/server/history/history.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,o){var c,l=arguments.length,i=l<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(c=e[s])&&(i=(l<3?c(i):l>3?c(t,r,i):c(t,r))||i);return l>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),r=require("./history-subscription.controller");let o=class{};o=e([t.Module({controllers:[r.HistorySubscriptionController]})],o),exports.HistoryModule=o;
},{"./history-subscription.controller":"app/server/history/history-subscription.controller.ts"}],"app/server/services/compile.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,i,o){var c,r=arguments.length,n=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var l=e.length-1;l>=0;l--)(c=e[l])&&(n=(r<3?c(n):r>3?c(t,i,n):c(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("@rxdi/core"),c=require("../../plugins/compile/compile.plugin");let r=class{constructor(e){this.compilePlugin=e}buildFile(e="./packages/",t="index.ts",i="bla bla",o="@pesho",c){return this.compilePlugin.completeBuildAndAddToIpfs(e,t,i,o,"reactive.json",c)}pushTransaction(e="./packages/",t="index.ts",i="bla bla",o="@pesho",c){return this.compilePlugin.pushTransaction(e,t,i,o,"reactive.json",c)}};r=t([o.Service(),i("design:paramtypes",["function"==typeof(e=void 0!==c.CompilePlugin&&c.CompilePlugin)?e:Object])],r),exports.CompileService=r;
},{"../../plugins/compile/compile.plugin":"app/plugins/compile/compile.plugin.ts"}],"app/server/namespace/types/namespace.type.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i.throw(e))}catch(t){o(t)}}function c(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("graphql"),r=require("../../history/types/history.type"),i=require("@rxdi/core"),n=require("../../../services");exports.NamespaceType=new t.GraphQLObjectType({name:"Namespacetype",fields:{_id:{type:t.GraphQLString},name:{type:t.GraphQLString},builds:{type:new t.GraphQLList(r.HistoryType),resolve:t=>e(this,void 0,void 0,function*(){const e=i.Container.get(n.BuildHistoryService);return yield e.findAll(0,100,null,{namespaceId:t._id})})}}});
},{"../../history/types/history.type":"app/server/history/types/history.type.ts","../../../services":"app/services/index.ts"}],"app/server/namespace/types/namespace-list.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),p=require("./namespace.type");exports.NamespaceListType=new e.GraphQLObjectType({name:"NamespaceListType",fields:{count:{type:e.GraphQLInt},rows:{type:new e.GraphQLList(p.NamespaceType)}}});
},{"./namespace.type":"app/server/namespace/types/namespace.type.ts"}],"app/server/namespace/namespace.controller.ts":[function(require,module,exports) {
"use strict";var e,t,n=this&&this.__decorate||function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function s(e){try{p(r.next(e))}catch(t){a(t)}}function c(e){try{p(r.throw(e))}catch(t){a(t)}}function p(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,c)}p((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("@gapi/core"),s=require("./types/namespace.type"),c=require("./services/namespace.service"),p=require("./types/namespace-list.type");let o=class{constructor(e){this.namespaceService=e}getNamespace(e,{id:t}){return this.namespaceService.getNamespaceById(t)}insertNamespace(e,{name:t}){return i(this,void 0,void 0,function*(){if(yield this.namespaceService.searchForDuplicates(t))throw new Error("Namespace already exists!");return yield this.namespaceService.insert({name:t})})}listNamespaces(e,{skip:t,limit:n}){return i(this,void 0,void 0,function*(){const e=yield this.namespaceService.listNamespaces(t,n);return{count:e.length,rows:e}})}};n([a.Type(s.NamespaceType),a.Query({id:{type:a.GraphQLString}}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",void 0)],o.prototype,"getNamespace",null),n([a.Type(s.NamespaceType),a.Mutation({name:{type:a.GraphQLString}}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],o.prototype,"insertNamespace",null),n([a.Type(p.NamespaceListType),a.Query({skip:{type:a.GraphQLInt},limit:{type:a.GraphQLInt}}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype","function"==typeof(e="undefined"!=typeof Promise&&Promise)?e:Object)],o.prototype,"listNamespaces",null),o=n([a.Controller(),r("design:paramtypes",["function"==typeof(t=void 0!==c.NamespaceService&&c.NamespaceService)?t:Object])],o),exports.NamespaceController=o;
},{"./types/namespace.type":"app/server/namespace/types/namespace.type.ts","./services/namespace.service":"app/server/namespace/services/namespace.service.ts","./types/namespace-list.type":"app/server/namespace/types/namespace-list.type.ts"}],"app/server/namespace/namespace.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,c){var o,s=arguments.length,l=s<3?r:null===c?c=Object.getOwnPropertyDescriptor(r,t):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,r,t,c);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(l=(s<3?o(l):s>3?o(r,t,l):o(r,t))||l);return s>3&&l&&Object.defineProperty(r,t,l),l};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@rxdi/core"),t=require("./namespace.controller"),c=require("./services/namespace.service");let o=class{};o=e([r.Module({controllers:[t.NamespaceController],services:[c.NamespaceService]})],o),exports.NamespaceModule=o;
},{"./namespace.controller":"app/server/namespace/namespace.controller.ts","./services/namespace.service":"app/server/namespace/services/namespace.service.ts"}],"app/server/build/types/build-meta-info.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");exports.BuildMetaInfo=new e.GraphQLObjectType({name:"BuildMetaInfo",fields:()=>({path:{type:e.GraphQLString},hash:{type:e.GraphQLString}})});
},{}],"app/server/build/types/build.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),t=require("./build-meta-info.type");exports.BuildType=new e.GraphQLObjectType({name:"BuildType",fields:{file:{type:new e.GraphQLList(t.BuildMetaInfo)},typings:{type:new e.GraphQLList(t.BuildMetaInfo)},module:{type:new e.GraphQLList(t.BuildMetaInfo)},status:{type:e.GraphQLString}}});
},{"./build-meta-info.type":"app/server/build/types/build-meta-info.type.ts"}],"app/server/history/types/history-list.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),t=require("./history.type");exports.HistoryListType=new e.GraphQLObjectType({name:"HistoryListType",fields:{count:{type:e.GraphQLInt},rows:{type:new e.GraphQLList(t.HistoryType)}}});
},{"./history.type":"app/server/history/types/history.type.ts"}],"app/server/build/types/process.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@gapi/core");exports.ProcessStdOutType=new e.GraphQLObjectType({name:"ProcessStdOutType",fields:{stdout:{type:e.GraphQLString}}});
},{}],"app/server/build/build.controller.ts":[function(require,module,exports) {
"use strict";var e,t,i,r,n,o,s,u=this&&this.__decorate||function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var u=e.length-1;u>=0;u--)(n=e[u])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function u(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(s,u)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const l=require("@gapi/core"),a=require("./types/build.type"),y=require("../services/compile.service"),d=require("../../services"),f=require("../history/types/history-list.type"),b=require("./types/built-status.type"),g=require("./types/process.type"),h=require("fs"),S=require("util");let v=class{constructor(e,t,i,r,n,o){this.compileService=e,this.buildHistoryService=t,this.pubsub=i,this.fileService=r,this.tsGenerator=n,this.loggerService=o}triggerBuild(e,{folder:t,file:i,message:r,namespace:n,buildFolder:o}){return p(this,void 0,void 0,function*(){return new Promise((e,s)=>p(this,void 0,void 0,function*(){try{yield this.fileService.writeFile(t+"/tsconfig.json",this.tsGenerator.getTsConfig(i.replace(".ts","")));const c=h.createWriteStream(`${t}/${i}.log`,{flags:"w"}),p=this.loggerService.stdout.subscribe(e=>{c.write(S.format(e)+"\n"),this.pubsub.publish("CREATE_SIGNAL_BASIC",{message:S.format(e)})});let l;const a=()=>{p.unsubscribe(),c.close(),l.unsubscribe()};l=this.compileService.buildFile(t,i,r,n,o).subscribe(t=>{e(Object.assign({status:"Finish"},t)),a()},e=>{a(),s(e||"Build failed")})}catch(u){s(u||"Build failed")}}))})}getBuildHistory(e,{skip:t,limit:i,where:r}){return p(this,void 0,void 0,function*(){const e=yield this.buildHistoryService.findAll(t,i,null,r);return{count:e.length,rows:e}})}buildStatus(e){return{payload:e}}processStdOut(e){return{payload:e}}};u([l.Type(a.BuildType),l.Mutation({folder:{type:new l.GraphQLNonNull(l.GraphQLString)},file:{type:new l.GraphQLNonNull(l.GraphQLString)},message:{type:new l.GraphQLNonNull(l.GraphQLString)},namespace:{type:new l.GraphQLNonNull(l.GraphQLString)},buildFolder:{type:l.GraphQLString}}),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",Promise)],v.prototype,"triggerBuild",null),u([l.Type(f.HistoryListType),l.Query({skip:{type:l.GraphQLInt},limit:{type:l.GraphQLInt},where:{type:new l.GraphQLInputObjectType({name:"BuildWhereType",fields:{namespaceId:{type:l.GraphQLString},name:{type:l.GraphQLString}}})}}),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype","function"==typeof(e="undefined"!=typeof Promise&&Promise)?e:Object)],v.prototype,"getBuildHistory",null),u([l.Type(b.BuildStatusType),l.Subscribe(e=>e.pubsub.asyncIterator("LISTEN_FOR_BUILDS")),l.Subscription(),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],v.prototype,"buildStatus",null),u([l.Type(g.ProcessStdOutType),l.Subscribe(e=>e.pubsub.asyncIterator("PROCESS_STDOUT")),l.Subscription(),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],v.prototype,"processStdOut",null),v=u([l.Controller(),c("design:paramtypes",["function"==typeof(t=void 0!==y.CompileService&&y.CompileService)?t:Object,"function"==typeof(i=void 0!==d.BuildHistoryService&&d.BuildHistoryService)?i:Object,"function"==typeof(r=void 0!==l.PubSubService&&l.PubSubService)?r:Object,"function"==typeof(n=void 0!==d.FileService&&d.FileService)?n:Object,"function"==typeof(o=void 0!==d.TsConfigGenratorService&&d.TsConfigGenratorService)?o:Object,"function"==typeof(s=void 0!==d.LoggerService&&d.LoggerService)?s:Object])],v),exports.BuildController=v;
},{"./types/build.type":"app/server/build/types/build.type.ts","../services/compile.service":"app/server/services/compile.service.ts","../../services":"app/services/index.ts","../history/types/history-list.type":"app/server/history/types/history-list.type.ts","./types/built-status.type":"app/server/build/types/built-status.type.ts","./types/process.type":"app/server/build/types/process.type.ts"}],"app/server/build/build.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,o){var l,c=arguments.length,i=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var n=e.length-1;n>=0;n--)(l=e[n])&&(i=(c<3?l(i):c>3?l(t,r,i):l(t,r))||i);return c>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),r=require("./build.controller");let o=class{};o=e([t.Module({controllers:[r.BuildController]})],o),exports.BuildModule=o;
},{"./build.controller":"app/server/build/build.controller.ts"}],"app/server/file/types/file.arguments.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("graphql");exports.FileArguments={size:{type:t.GraphQLString},birthtime:{type:t.GraphQLString},ctime:{type:t.GraphQLString},mtime:{type:t.GraphQLString},atime:{type:t.GraphQLString},birthtimeMs:{type:t.GraphQLString},ctimeMs:{type:t.GraphQLString},mtimeMs:{type:t.GraphQLString},atimeMs:{type:t.GraphQLString},blocks:{type:t.GraphQLInt},ino:{type:t.GraphQLInt},blksize:{type:t.GraphQLInt},rdev:{type:t.GraphQLInt},gid:{type:t.GraphQLInt},uid:{type:t.GraphQLInt},nlink:{type:t.GraphQLInt},mode:{type:t.GraphQLInt},dev:{type:t.GraphQLInt}};
},{}],"app/server/file/types/file-status.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@gapi/core"),t=require("./file.arguments");exports.FileStatusType=new e.GraphQLObjectType({name:"FileStatusType",fields:t.FileArguments});
},{"./file.arguments":"app/server/file/types/file.arguments.ts"}],"app/server/file/types/folder-structure.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),t=require("./file-status.type");exports.FolderStructureType=new e.GraphQLObjectType({name:"FolderStructureType",fields:{path:{type:e.GraphQLString},directory:{type:e.GraphQLBoolean},file:{type:e.GraphQLBoolean},name:{type:e.GraphQLString},status:{type:t.FileStatusType}}});
},{"./file-status.type":"app/server/file/types/file-status.type.ts"}],"app/server/file/types/file.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),r=require("./folder-structure.type");exports.FileType=new e.GraphQLObjectType({name:"FileType",fields:{paths:{type:new e.GraphQLList(r.FolderStructureType)}}});
},{"./folder-structure.type":"app/server/file/types/folder-structure.type.ts"}],"app/server/file/types/file-raw.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");exports.FileRawType=new e.GraphQLObjectType({name:"FileRawType",fields:{package:{type:e.GraphQLString},file:{type:e.GraphQLString}}});
},{}],"app/server/file/file.controller.ts":[function(require,module,exports) {
"use strict";var e,t,i=this&&this.__decorate||function(e,t,i,r){var l,n=arguments.length,c=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(l=e[o])&&(c=(n<3?l(c):n>3?l(t,i,c):l(t,i))||c);return n>3&&c&&Object.defineProperty(t,i,c),c},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(l,n){function c(e){try{s(r.next(e))}catch(t){n(t)}}function o(e){try{s(r.throw(e))}catch(t){n(t)}}function s(e){e.done?l(e.value):new i(function(t){t(e.value)}).then(c,o)}s((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),c=require("@gapi/core"),o=require("./types/file.type"),s=require("./services/file.service"),a=require("../../services/file/file.service"),p=require("./types/file-raw.type"),u=require("../../services"),f=require("graphql");let d=class{constructor(e,t){this.fileServiceInternal=e,this.fileService=t}listFiles(e,{folder:t}){return l(this,void 0,void 0,function*(){let e;return u.includes("--enable-full-folder-access")?e=t:(t=t.replace(".",""),e=process.cwd()+t),{paths:yield this.fileServiceInternal.listFolder(e)}})}readFile(e,{folder:t},i){return l(this,void 0,void 0,function*(){let e;u.includes("--enable-full-folder-access")?e=t:(t=t.replace(".",""),e=process.cwd()+t);const i=e.split(".").pop(),r="jpg"===i||"jpeg"===i||"png"===i;let l=yield this.fileService.readFile(e);r&&(l=`data:image/${i};base64, ${l=(yield this.fileService.readFileRaw(e)).toString("base64")}`);let n=null;try{n=yield this.fileService.readFile(e.substring(0,e.lastIndexOf("/"))+"/reactive.json")}catch(c){}return{package:n,file:l}})}saveFile(e,{folder:t,content:i}){return l(this,void 0,void 0,function*(){let e;return u.includes("--enable-full-folder-access")?e=t:(t=t.replace(".",""),e=process.cwd()+t),yield this.fileService.writeFile(e,i),{file:yield this.fileService.readFile(e)}})}};i([c.Type(o.FileType),c.Query({folder:{type:f.GraphQLString}}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],d.prototype,"listFiles",null),i([c.Type(p.FileRawType),c.Query({folder:{type:new f.GraphQLNonNull(f.GraphQLString)}}),r("design:type",Function),r("design:paramtypes",[Object,Object,Object]),r("design:returntype",Promise)],d.prototype,"readFile",null),i([c.Type(p.FileRawType),c.Query({folder:{type:new f.GraphQLNonNull(f.GraphQLString)},content:{type:new f.GraphQLNonNull(f.GraphQLString)}}),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],d.prototype,"saveFile",null),d=i([n.Controller(),r("design:paramtypes",["function"==typeof(e=void 0!==s.FileService&&s.FileService)?e:Object,"function"==typeof(t=void 0!==a.FileService&&a.FileService)?t:Object])],d),exports.FileController=d;
},{"./types/file.type":"app/server/file/types/file.type.ts","./services/file.service":"app/server/file/services/file.service.ts","../../services/file/file.service":"app/services/file/file.service.ts","./types/file-raw.type":"app/server/file/types/file-raw.type.ts","../../services":"app/services/index.ts"}],"app/server/file/file.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,o){var l,c=arguments.length,i=c<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)(l=e[s])&&(i=(c<3?l(i):c>3?l(r,t,i):l(r,t))||i);return c>3&&i&&Object.defineProperty(r,t,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@rxdi/core"),t=require("./services/file.service"),o=require("./file.controller");let l=class{};l=e([r.Module({services:[t.FileService],controllers:[o.FileController]})],l),exports.FileModule=l;
},{"./services/file.service":"app/server/file/services/file.service.ts","./file.controller":"app/server/file/file.controller.ts"}],"app/server/transactions/types/transaction-enum.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql");exports.TransactionTypeEnum=new e.GraphQLEnumType({name:"TransactionsTypeEnum",values:{DEPLOYED:{value:"DEPLOYED"},COMMITED:{value:"COMMITED"},UNKNOWN:{value:"UNKNOWN"},BUILD:{value:"BUILD"}}});
},{}],"app/server/transactions/types/transaction.type.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("graphql"),t=require("./transaction-enum.type");exports.TransactionType=new e.GraphQLObjectType({name:"TransactionType",fields:{_id:{type:e.GraphQLString},status:{type:t.TransactionTypeEnum},birthtime:{type:e.GraphQLString},path:{type:e.GraphQLString},repoFolder:{type:e.GraphQLString},hash:{type:e.GraphQLString},namespace:{type:e.GraphQLString},message:{type:e.GraphQLString}}});
},{"./transaction-enum.type":"app/server/transactions/types/transaction-enum.type.ts"}],"app/server/transactions/services/transaction/transaction.service.ts":[function(require,module,exports) {
"use strict";var e,t,i,r,o,s,n,c=this&&this.__decorate||function(e,t,i,r){var o,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,s){function n(e){try{a(r.next(e))}catch(t){s(t)}}function c(e){try{a(r.throw(e))}catch(t){s(t)}}function a(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(n,c)}a((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const d=require("@rxdi/core"),u=require("../../../../../env.injection.tokens"),p=require("../../../services/compile.service"),h=require("@gapi/core"),f=require("../../../..//services"),v=require("../../../file/services/file.service"),m=require("util"),y=require("fs"),g=require("path");let S=class{constructor(e,t,i,r,o,s){this.compileService=e,this.pubsub=t,this.fileService=i,this.appFileService=r,this.tsGenerator=o,this.loggerService=s}getTransactionById(e){return new Promise((t,i)=>{this.transaction.findOne({_id:e},(e,r)=>{e&&i(e),console.log(r),t(r)})})}getTransactionByPath(e,t,i){return new Promise((i,r)=>{this.transaction.findOne({path:e,repoFolder:t},(e,t)=>{e&&r(e),i(t)})})}getTransactionByRepo(e,t={}){return new Promise((i,r)=>{this.transaction.findOne(Object.assign({repoFolder:e},t),(e,t)=>{e&&r(e),i(t)})})}add(e){return l(this,void 0,void 0,function*(){const t=yield this.getTransactionByPath(e.path,e.repoFolder,{status:"UNKNOWN"});if(t)throw new Error(`File is already added to transaction ${t._id}: ${t.path} and not commited use (rxdi commit "my-message")`);return yield new Promise((t,i)=>{this.transaction.insert(e,(e,r)=>l(this,void 0,void 0,function*(){e&&i(e);try{yield this.fileService.copyTransactionFiles(r._id,r.repoFolder,r.path)}catch(e){return i(e)}t(r)}))})})}checkout(e){return l(this,void 0,void 0,function*(){const t=yield this.getTransactionByPath(e.path,e.repoFolder);if(!t)throw new Error(`Transaction doesn't exist ${e.path}`);return yield this.fileService.removeTransaction(t._id,t.repoFolder,t.path).toPromise(),yield new Promise((e,i)=>{this.transaction.remove(t,(t,r)=>{t&&i(t),e(r)})})})}update(e,t){return l(this,void 0,void 0,function*(){return yield new Promise((i,r)=>{this.transaction.update({repoFolder:e},t,{},(e,t)=>l(this,void 0,void 0,function*(){e&&r(e),i(t)}))})})}commit({repoFolder:e,message:t}){return l(this,void 0,void 0,function*(){console.log(e,t);const i=yield this.getTransactionByRepo(e);if(!i)throw new Error(`Transaction doesn't exist ${e}`);if(i.message=t,i.status="COMMITED",!(yield this.update(e,i)))throw new Error("Transaction not commited");return i})}deploy(e,t,i,r,o){const{filename:s,transactionFolder:n,filePath:c}=this.fileService.prepareCopyData(e,t,i);return new Promise((t,a)=>l(this,void 0,void 0,function*(){yield this.appFileService.writeFile(c+"/tsconfig.json",this.tsGenerator.getTsConfig(s.replace(".ts","")));let l={browserslist:[]};if(yield m.promisify(y.exists)(g.join(c,"package.json"))){if((l=JSON.parse(yield m.promisify(y.readFile)(g.join(c,"package.json"),{encoding:"utf-8"}))).browserslist&&l.browserslist.length){l.browserslist.find(e=>e.includes("last 1 chrome versions"))||l.browserslist.push("last 1 chrome versions")}else l.browserslist.push("last 1 chrome versions");yield m.promisify(y.writeFile)(g.join(c,"package.json"),JSON.stringify(l))}else yield this.appFileService.writeFile(c+"/package.json",this.tsGenerator.getPackageJson());const d=y.createWriteStream(`${n}/${s}.log`,{flags:"w"}),u=this.loggerService.stdout.subscribe(e=>{d.write(m.format(e)+"\n"),this.pubsub.publish("CREATE_SIGNAL_BASIC",{message:m.format(e)})});let p;const h=()=>{u.unsubscribe(),d.close(),p.unsubscribe()};p=this.compileService.pushTransaction(n,i,r,o,"build").subscribe(({module:i})=>{t({message:r,_id:e,hash:i.hash}),h()},e=>{h(),a(e||"Build failed")})}))}push({repoFolder:e}){return l(this,void 0,void 0,function*(){const t=yield this.getTransactionByRepo(e,{status:"COMMITED"});if(!t)throw new Error(`No commited transactions inside ${e} \n✎ Maybe you forgot to commit? example: (rxdi commit "my-message")`);if(yield this.deploy(t._id,t.repoFolder,t.path,t.message,t.namespace),t.status="DEPLOYED",!(yield this.update(e,t)))throw new Error("Transaction not commited");return t})}listTransactions(e,t,i=0,r=100,o={createdAt:-1}){const s={};return"UNKNOWN"!==e&&(s.status=e),s.repoFolder=t,console.log(s),new Promise((e,t)=>{this.transaction.find(s).sort(o).skip(i).limit(r).exec((i,r)=>{i&&t(i),e(r)})})}};c([d.Inject(u.__TRANSACTIONS_DATABASE),a("design:type","function"==typeof(e=void 0!==u.__TRANSACTIONS_DATABASE&&u.__TRANSACTIONS_DATABASE)?e:Object)],S.prototype,"transaction",void 0),S=c([d.Injectable(),a("design:paramtypes",["function"==typeof(t=void 0!==p.CompileService&&p.CompileService)?t:Object,"function"==typeof(i=void 0!==h.PubSubService&&h.PubSubService)?i:Object,"function"==typeof(r=void 0!==v.FileService&&v.FileService)?r:Object,"function"==typeof(o=void 0!==f.FileService&&f.FileService)?o:Object,"function"==typeof(s=void 0!==f.TsConfigGenratorService&&f.TsConfigGenratorService)?s:Object,"function"==typeof(n=void 0!==f.LoggerService&&f.LoggerService)?n:Object])],S),exports.TransactionService=S;
},{"../../../../../env.injection.tokens":"env.injection.tokens.ts","../../../services/compile.service":"app/server/services/compile.service.ts","../../../..//services":"app/services/index.ts","../../../file/services/file.service":"app/server/file/services/file.service.ts"}],"app/core/api-introspection/index.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
},{}],"app/server/transactions/transactions.controller.ts":[function(require,module,exports) {
"use strict";var t,e,n,r,a,i=this&&this.__decorate||function(t,e,n,r){var a,i=arguments.length,o=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var p=t.length-1;p>=0;p--)(a=t[p])&&(o=(i<3?a(o):i>3?a(e,n,o):a(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},o=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});const p=require("@gapi/core"),s=require("./types/transaction.type"),c=require("./services/transaction/transaction.service"),u=require("./types/transaction-enum.type"),y=require("../../core/api-introspection");let l=class{constructor(t){this.transactionSevice=t}addTransaction(t,e){return this.transactionSevice.add(Object.assign({},e,{status:"UNKNOWN"}))}checkoutTransaction(t,e){return this.transactionSevice.checkout(e)}commitTransaction(t,e){return this.transactionSevice.commit(e)}pushTransactionMutation(t,e){return this.transactionSevice.push(e)}listTransactions(t,{status:e,repoFolder:n}){return this.transactionSevice.listTransactions(e,n)}};i([p.Mutation({path:{type:new p.GraphQLNonNull(p.GraphQLString)},birthtime:{type:new p.GraphQLNonNull(p.GraphQLString)},repoFolder:{type:new p.GraphQLNonNull(p.GraphQLString)},namespace:{type:new p.GraphQLNonNull(p.GraphQLString)}}),o("design:type",Function),o("design:paramtypes",[Object,"function"==typeof(t=void 0!==y.ITransactionType&&y.ITransactionType)?t:Object]),o("design:returntype",void 0)],l.prototype,"addTransaction",null),i([p.Mutation({path:{type:new p.GraphQLNonNull(p.GraphQLString)},repoFolder:{type:new p.GraphQLNonNull(p.GraphQLString)}}),o("design:type",Function),o("design:paramtypes",[Object,"function"==typeof(e=void 0!==y.ITransactionType&&y.ITransactionType)?e:Object]),o("design:returntype",void 0)],l.prototype,"checkoutTransaction",null),i([p.Mutation({message:{type:new p.GraphQLNonNull(p.GraphQLString)},repoFolder:{type:new p.GraphQLNonNull(p.GraphQLString)}}),o("design:type",Function),o("design:paramtypes",[Object,"function"==typeof(n=void 0!==y.ITransactionType&&y.ITransactionType)?n:Object]),o("design:returntype",void 0)],l.prototype,"commitTransaction",null),i([p.Mutation({repoFolder:{type:new p.GraphQLNonNull(p.GraphQLString)}}),o("design:type",Function),o("design:paramtypes",[Object,"function"==typeof(r=void 0!==y.ITransactionType&&y.ITransactionType)?r:Object]),o("design:returntype",void 0)],l.prototype,"pushTransactionMutation",null),i([p.Type(new p.GraphQLList(s.TransactionType)),p.Query({status:{type:u.TransactionTypeEnum},repoFolder:{type:new p.GraphQLNonNull(p.GraphQLString)}}),o("design:type",Function),o("design:paramtypes",[Object,Object]),o("design:returntype",void 0)],l.prototype,"listTransactions",null),l=i([p.Controller({guards:[],type:s.TransactionType}),o("design:paramtypes",["function"==typeof(a=void 0!==c.TransactionService&&c.TransactionService)?a:Object])],l),exports.TransactionsController=l;
},{"./types/transaction.type":"app/server/transactions/types/transaction.type.ts","./services/transaction/transaction.service":"app/server/transactions/services/transaction/transaction.service.ts","./types/transaction-enum.type":"app/server/transactions/types/transaction-enum.type.ts","../../core/api-introspection":"app/core/api-introspection/index.ts"}],"app/server/transactions/transactions.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,o){var c,n=arguments.length,s=n<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,t,o);else for(var i=e.length-1;i>=0;i--)(c=e[i])&&(s=(n<3?c(s):n>3?c(r,t,s):c(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("@gapi/core"),t=require("./transactions.controller"),o=require("./services/transaction/transaction.service");let c=class{};c=e([r.Module({controllers:[t.TransactionsController],providers:[o.TransactionService]})],c),exports.TransactionsModule=c;
},{"./transactions.controller":"app/server/transactions/transactions.controller.ts","./services/transaction/transaction.service":"app/server/transactions/services/transaction/transaction.service.ts"}],"app/server/server.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,t,i){var o,n=arguments.length,s=n<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,t,i);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(s=(n<3?o(s):n>3?o(r,t,s):o(r,t))||s);return n>3&&s&&Object.defineProperty(r,t,s),s},r=this&&this.__awaiter||function(e,r,t,i){return new(t||(t=Promise))(function(o,n){function s(e){try{c(i.next(e))}catch(r){n(r)}}function u(e){try{c(i.throw(e))}catch(r){n(r)}}function c(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(s,u)}c((i=i.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),i=require("./services/webui.service"),o=require("./services/server-push.service"),n=require("./user/user-queries.controller"),s=require("./history/history.module"),u=require("./services/compile.service"),c=require("./namespace/namespace.module"),l=require("./build/build.module"),a=require("./file/file.module"),d=require("./transactions/transactions.module"),v=require("@gapi/core"),p=require("../../env.injection.tokens"),f=require("../services");let h=class{};h=e([t.Module({imports:[s.HistoryModule,c.NamespaceModule,l.BuildModule,a.FileModule,d.TransactionsModule],services:[i.WebUiService,o.ServerPushService,u.CompileService],controllers:[n.UserQueriesController],providers:[{provide:v.ON_REQUEST_HANDLER,deps:[v.GRAPHQL_PLUGIN_CONFIG],useFactory:e=>(i,o,n,s)=>r(this,void 0,void 0,function*(){let r;try{r=t.Container.get(p.RequestHandler)}catch(n){}if(r&&r.handler)try{e.graphqlOptions.context=yield r.handler(o)}catch(n){return v.Boom.unauthorized()}else e.graphqlOptions.context=null;return i()})},{provide:v.RESOLVER_HOOK,useFactory:()=>e=>{const i=e.resolve.bind(e.target);if(f.nextOrDefault("--interceptor")){let n;try{n=t.Container.get(p.RequestHandler)}catch(o){}n&&n.resolverHook&&(e.resolve=function(t,o,s,u,...c){return r(this,void 0,void 0,function*(){return yield n.resolverHook(e,t,o,s,u),i(t,o,s,u,...c)})})}return e}}]})],h),exports.ServerModule=h;
},{"./services/webui.service":"app/server/services/webui.service.ts","./services/server-push.service":"app/server/services/server-push.service.ts","./user/user-queries.controller":"app/server/user/user-queries.controller.ts","./history/history.module":"app/server/history/history.module.ts","./services/compile.service":"app/server/services/compile.service.ts","./namespace/namespace.module":"app/server/namespace/namespace.module.ts","./build/build.module":"app/server/build/build.module.ts","./file/file.module":"app/server/file/file.module.ts","./transactions/transactions.module":"app/server/transactions/transactions.module.ts","../../env.injection.tokens":"env.injection.tokens.ts","../services":"app/services/index.ts"}],"app/core/helpers/transpile-typescript.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("child_process");exports.TranspileTypescript=((r,s)=>new Promise((o,t)=>{const p=e.spawn("npx",["gapi","build","--glob",`${r.toString()}`,"--outDir",s]);p.stderr.pipe(process.stderr),p.on("close",e=>o(e))}));
},{}],"app/core/helpers/get-first-item.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("util");function t(t){if(!t)return null;let r;for(const e in t){r=e;break}if(!t[r])throw new Error(`Missing method ${r}`);return e.isFunction(t[r])&&(t=t[r]),t}exports.getFirstItem=t;
},{}],"app/core/helpers/get-second-item.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("util");function t(t){if(!t)return null;let r,n=0;for(const e in t){if(1===n){r=e;break}n++}if(!t[r])throw new Error(`Missing method ${r}`);return e.isFunction(t[r])&&(t=t[r]),t}exports.getSecondItem=t;
},{}],"app/app.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,r,i,t){var s,c=arguments.length,o=c<3?r:null===t?t=Object.getOwnPropertyDescriptor(r,i):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,r,i,t);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(o=(c<3?s(o):c>3?s(r,i,o):s(r,i))||o);return c>3&&o&&Object.defineProperty(r,i,o),o},r=this&&this.__awaiter||function(e,r,i,t){return new(i||(i=Promise))(function(s,c){function o(e){try{u(t.next(e))}catch(r){c(r)}}function n(e){try{u(t.throw(e))}catch(r){c(r)}}function u(e){e.done?s(e.value):new i(function(r){r(e.value)}).then(o,n)}u((t=t.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("@rxdi/core"),t=require("@gapi/ipfs"),s=require("@gapi/ipfs-daemon"),c=require("./services/ipfs-file/ipfs-file.service"),o=require("./services/file/file.service"),n=require("./services/parcel-bundler/parcel-bundler.service"),u=require("./services/file/file-user.service"),l=require("./services/dts-generator/dts-generator.service"),p=require("./services/tsconfig-generator/tsconfig-generator.service"),a=require("./services/table-service/table-service"),v=require("./status/status.module"),f=require("./services/build-history/build-history.service"),d=require("./services/error-reason/error-reason.service"),g=require("./plugins/compile/compile.plugin"),q=require("./services/time/time.service"),S=require("./services"),h=require("./server/server.module"),m=require("./core/helpers/transpile-typescript"),y=require("path"),P=require("./core/helpers/get-first-item"),I=require("../env.injection.tokens"),_=require("./core/helpers/get-second-item"),b=[s.IpfsDaemonModule.forRoot({type:S.nextOrDefault("--default-ipfs-node","go"),config:{Addresses:{API:process.env.IPFS_API_PORT?process.env.IPFS_API_PORT:S.nextOrDefault("--ipfs-api-port","/ip4/0.0.0.0/tcp/5002",e=>`/ip4/0.0.0.0/tcp/${e}`),Gateway:process.env.IPFS_API_GATEWAY?process.env.IPFS_API_GATEWAY:S.nextOrDefault("--ipfs-api-gateway","/ip4/0.0.0.0/tcp/8081",e=>`/ip4/0.0.0.0/tcp/${e}`),Swarm:S.nextOrDefault("--ipfs-swarms",["/ip4/0.0.0.0/tcp/4001","/ip6/::/tcp/4001"],e=>e.split(","))}}}),t.IpfsModule.forRoot(),v.StatusModule];S.includes("--webui")&&b.push(h.ServerModule);let w=class{};w=e([i.Module({imports:b,services:[c.FileIpfsService,o.FileService,n.ParcelBundlerService,u.FileUserService,l.TypescriptDefinitionGeneratorService,p.TsConfigGenratorService,a.TableService,f.BuildHistoryService,d.ErrorReasonService,q.TimeService,S.HtmlTemplateBuilder,S.PackageJsonService,S.PreviousService,S.LoggerService],plugins:[g.CompilePlugin],providers:[{provide:I.RequestHandler,lazy:!0,useFactory:()=>r(this,void 0,void 0,function*(){const e=S.nextOrDefault("--interceptor",null);if(e){yield m.TranspileTypescript([e.replace(".","")],"interceptor");const r=y.join(process.cwd(),"interceptor",e.replace("ts","js"));return{handler:P.getFirstItem(require(r)),resolverHook:_.getSecondItem(require(r))}}return{handler:null}})}]})],w),exports.AppModule=w;
},{"./services/ipfs-file/ipfs-file.service":"app/services/ipfs-file/ipfs-file.service.ts","./services/file/file.service":"app/services/file/file.service.ts","./services/parcel-bundler/parcel-bundler.service":"app/services/parcel-bundler/parcel-bundler.service.ts","./services/file/file-user.service":"app/services/file/file-user.service.ts","./services/dts-generator/dts-generator.service":"app/services/dts-generator/dts-generator.service.ts","./services/tsconfig-generator/tsconfig-generator.service":"app/services/tsconfig-generator/tsconfig-generator.service.ts","./services/table-service/table-service":"app/services/table-service/table-service.ts","./status/status.module":"app/status/status.module.ts","./services/build-history/build-history.service":"app/services/build-history/build-history.service.ts","./services/error-reason/error-reason.service":"app/services/error-reason/error-reason.service.ts","./plugins/compile/compile.plugin":"app/plugins/compile/compile.plugin.ts","./services/time/time.service":"app/services/time/time.service.ts","./services":"app/services/index.ts","./server/server.module":"app/server/server.module.ts","./core/helpers/transpile-typescript":"app/core/helpers/transpile-typescript.ts","./core/helpers/get-first-item":"app/core/helpers/get-first-item.ts","../env.injection.tokens":"env.injection.tokens.ts","./core/helpers/get-second-item":"app/core/helpers/get-second-item.ts"}],"gapi-framework-imports.ts":[function(require,module,exports) {
"use strict";var e,r=this&&this.__decorate||function(e,r,t,o){var n,a=arguments.length,s=a<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,r,t,o);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(s=(a<3?n(s):a>3?n(r,t,s):n(r,t))||s);return a>3&&s&&Object.defineProperty(r,t,s),s};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@gapi/core"),o=require("./app/services/helpers/helpers");let n=e=class{static forRoot(r){let n=[];return r&&(n=[t.CoreModule.forRoot({server:{randomPort:!process.env.RANDOM_PORT&&o.nextOrDefault("--random-port",!1,Boolean),hapi:{port:process.env.API_PORT?process.env.API_PORT:o.nextOrDefault("--graphql-api-port",9300,Number),routes:{cors:{origin:["*"],additionalHeaders:["Host","User-Agent","Accept","Accept-Language","Accept-Encoding","Access-Control-Request-Method","Access-Control-Allow-Origin","Access-Control-Request-Headers","Origin","Connection","Pragma","Cache-Control"]}}}},graphql:{path:o.nextOrDefault("--graphql-endpoint","/graphql"),openBrowser:o.includes("--open-browser-graphiql"),watcherPort:o.nextOrDefault("--open-browser-graphiql",8967),writeEffects:o.includes("--write-effects"),graphiQlPlayground:o.includes("--graphiql-playground"),graphiQlPath:o.nextOrDefault("--graphiql-endpoint","/graphiql"),graphiqlOptions:{endpointURL:o.nextOrDefault("--graphql-endpoint","/graphql"),passHeader:`'Authorization':'${o.nextOrDefault("--graphiql-auth-token","")}'`,subscriptionsEndpoint:o.nextOrDefault("--graphiql-subscription-endpoint","ws://localhost:9300/subscriptions"),websocketConnectionParams:{token:o.nextOrDefault("--graphiql-auth-token","")}},graphqlOptions:{schema:null}}})]),{module:e,frameworkImports:n}}};n=e=r([t.Module()],n),exports.GapiFrameworkImports=n;
},{"./app/services/helpers/helpers":"app/services/helpers/helpers.ts"}],"app/core/helpers/npm-install.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,s,n,t){return new(n||(n=Promise))(function(i,o){function c(e){try{p(t.next(e))}catch(s){o(s)}}function r(e){try{p(t.throw(e))}catch(s){o(s)}}function p(e){e.done?i(e.value):new n(function(s){s(e.value)}).then(c,r)}p((t=t.apply(e,s||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("child_process"),n=require("path"),t=require("util"),i=require("fs");exports.NpmInstall=((o=[])=>e(this,void 0,void 0,function*(){const e=[];if(yield t.promisify(i.exists)(n.join(process.cwd(),"package.json"))){const s=JSON.parse(yield t.promisify(i.readFile)(n.join(process.cwd(),"package.json"),{encoding:"utf-8"}));if(s.dependencies){const n=Object.keys(s.dependencies).map(e=>`${e}@${s.dependencies[e]}`);e.push(...n)}}else e.push(...o);return console.log("Packages to be installed: ",e.join(" ")),new Promise((n,t)=>{const i=s.spawn("npm",["install",...e],{cwd:process.cwd().replace("files","")});i.stdout.pipe(process.stdout),i.stderr.pipe(process.stderr),i.on("close",e=>n(e))})}));
},{}],"main.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))(function(i,n){function s(e){try{c(o.next(e))}catch(r){n(r)}}function l(e){try{c(o.throw(e))}catch(r){n(r)}}function c(e){e.done?i(e.value):new t(function(r){r(e.value)}).then(s,l)}c((o=o.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("./check-arguments"),t=require("@rxdi/core"),o=require("./commands-description"),i=require("./app/services/helpers/helpers"),n=require("./app/services/logger/logger.service"),s=require("terminal-table"),l=console.log;if(console.log=function(...e){return t.Container.get(n.LoggerService).stdout.next(e.toString()),l(...e)},i.includes("--silent")&&(console.log=(()=>null)),i.includes("--help")){const e=new s({borderStyle:2,horizontalLine:!0,width:["20%","80%"],leftPadding:1});e.push(["Command","Description"]),e.push(["Available arguments are:"]),Object.keys(o.CommandDescription).forEach(r=>e.push([r,o.CommandDescription[r]])),e.attrRange({row:[0,1]},{align:"center",color:"green",bg:"black"}),console.log(""+e),process.exit(0)}r.checkArguments();const c=require("./environment-setter.module"),p=require("./app/app.module"),a=require("./gapi-framework-imports"),u=require("./app/core/helpers/transpile-typescript"),g=require("path"),d=require("./app/core/helpers/get-first-item"),m=require("./app/core/helpers/npm-install");t.Container.get(t.ConfigService).setConfig(Object.assign({},process.argv.toString().includes("-v")||process.argv.toString().includes("--verbose")?{logger:{logging:!0,hashes:!1,date:!0,exitHandler:!0,fileService:!0}}:{},{init:!1,initOptions:{services:!0,plugins:!0,controllers:!0}}));const h=[c.EnvironemntSetterModule,a.GapiFrameworkImports.forRoot(i.includes("--webui")||i.includes("--graphql-server-only"))];function f(){return e(this,void 0,void 0,function*(){if(i.includes("--globals")){const e=i.nextOrDefault("--globals",""),r=(e||"").split(",");r.length||r.push(e),yield m.NpmInstall(r)}if(i.includes("--import")){const r=i.nextOrDefault("--import","./import.ts");try{yield u.TranspileTypescript([r.replace(".","")],"import");const t=g.join(process.cwd(),"import",r.replace("ts","js"));h.push(d.getFirstItem(require(t)))}catch(e){console.log(e)}}t.BootstrapFramework(p.AppModule,h).subscribe(()=>{console.log("Started! Use --open-browser argument! Enjoy! :)")},e=>{throw new Error(e)})})}f();
},{"./check-arguments":"check-arguments.ts","./commands-description":"commands-description.ts","./app/services/helpers/helpers":"app/services/helpers/helpers.ts","./app/services/logger/logger.service":"app/services/logger/logger.service.ts","./environment-setter.module":"environment-setter.module.ts","./app/app.module":"app/app.module.ts","./gapi-framework-imports":"gapi-framework-imports.ts","./app/core/helpers/transpile-typescript":"app/core/helpers/transpile-typescript.ts","./app/core/helpers/get-first-item":"app/core/helpers/get-first-item.ts","./app/core/helpers/npm-install":"app/core/helpers/npm-install.ts"}]},{},["main.ts"], null)
//# sourceMappingURL=/main.js.map